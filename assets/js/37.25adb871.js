(window.webpackJsonp=window.webpackJsonp||[]).push([[37],{423:function(s,n,a){s.exports=a.p+"assets/img/55085469.e7bc3d58.png"},424:function(s,n,a){s.exports=a.p+"assets/img/57807542.5757cf27.png"},743:function(s,n,a){"use strict";a.r(n);var e=a(31),r=Object(e.a)({},(function(){var s=this,n=s.$createElement,e=s._self._c||n;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h2",{attrs:{id:"简介"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#简介"}},[s._v("#")]),s._v(" 简介")]),s._v(" "),e("h2",{attrs:{id:"整体架构"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#整体架构"}},[s._v("#")]),s._v(" 整体架构")]),s._v(" "),e("blockquote",[e("p",[s._v("eggjs框架新项目cloud-apps之Docker容器化")])]),s._v(" "),e("p",[s._v("一个主项目:Dockerfile + docker-compose")]),s._v(" "),e("p",[s._v("四个微服务项目:Dockerfile")]),s._v(" "),e("ul",[e("li",[e("strong",[s._v("neocloud:主")]),s._v("项目,书内容管理系统CMS;")]),s._v(" "),e("li",[s._v("**book_server:**网页生产epub项目;")]),s._v(" "),e("li",[s._v("**neocloud-statistics:**统计服务;")]),s._v(" "),e("li",[s._v("**onyx_drm:**下单后的图书加密服务;")]),s._v(" "),e("li",[s._v("**onyx-pay-micro:**支付服务;")])]),s._v(" "),e("h2",{attrs:{id:"内容管理表结构设计"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#内容管理表结构设计"}},[s._v("#")]),s._v(" 内容管理表结构设计")]),s._v(" "),e("blockquote",[e("p",[s._v("内容管理表结构设计&lib层级设计mysql")])]),s._v(" "),e("p",[e("img",{attrs:{src:a(423),alt:"img"}})]),s._v(" "),e("h2",{attrs:{id:"内容管理新表结构"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#内容管理新表结构"}},[s._v("#")]),s._v(" 内容管理新表结构")]),s._v(" "),e("blockquote",[e("p",[s._v("电子书包(内容管理)新表结构")])]),s._v(" "),e("p",[e("img",{attrs:{src:a(424),alt:"img"}})]),s._v(" "),e("h2",{attrs:{id:"各大支付系统对接"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#各大支付系统对接"}},[s._v("#")]),s._v(" 各大支付系统对接")]),s._v(" "),e("h3",{attrs:{id:"alipay"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#alipay"}},[s._v("#")]),s._v(" alipay")]),s._v(" "),e("h3",{attrs:{id:"stripe"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#stripe"}},[s._v("#")]),s._v(" stripe")]),s._v(" "),e("h2",{attrs:{id:"其他相关"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#其他相关"}},[s._v("#")]),s._v(" 其他相关")]),s._v(" "),e("p",[s._v("配置中碰到的主要问题有:")]),s._v(" "),e("p",[s._v("1:压缩优化;")]),s._v(" "),e("p",[s._v("2:多容器相互依赖,内容资源共享问题;")]),s._v(" "),e("hr"),s._v(" "),e("p",[e("strong",[s._v("配置步骤总括:")])]),s._v(" "),e("ol",[e("li",[s._v("拷贝docker文件的基础脚本;")]),s._v(" "),e("li",[s._v("把.dockerignore拷贝到上一级目录;")]),s._v(" "),e("li",[s._v("修改没有项目对应的脚本;")])]),s._v(" "),e("p",[s._v("简单eggjs服务容器脚本;")]),s._v(" "),e("p",[s._v("build.sh")]),s._v(" "),e("p",[e("strong",[s._v("docker build -t ${tagName} .")]),s._v(" 来构建image文件;示例:")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("sudo docker build -t mytomcat .\nsudo docker run -p 8080:8080 mytomcat  //在这里你可以加上特定参数\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('# sudo docker rmi $(sudo docker images -f "dangling=true" -q)       //rm none images\n# sudo docker build -t test_boilerplate .\nsudo docker build -t test_boilerplate -f docker/Dockerfile .\n# docker run --rm -d -p 8001:8001/tcp test_boilerplate:latest\n# docker run --rm -it -p 8001:8001/tcp test_boilerplate:latest\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("p",[s._v("Dockerfile; 多参照https://hub.docker.com/search 搜索后的例子配置:")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('#FROM node:8.6-alpine\nFROM node:10-alpine\nRUN apk --update add tzdata \\\n    && cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime \\\n    && echo "Asia/Shanghai" > /etc/timezone \\\n    && apk del tzdata\n# USER root\n#最后发现分开多层是没有用,已经有层次容器的话,不会再次更新.导致更新不及时;\nRUN apk update \\\n    && apk add --upgrade apk-tools \\\n    && apk upgrade --available \\\n    && apk add curl bash tree\n    \nRUN apk --update upgrade && \\ \n apk add --no-cache curl\n#ENTRYPOINT ["/usr/bin/curl"]\nRUN rm -r /usr/share/man && \\\n    find / -type f -iname \\*.apk-new -delete && \\\n    rm -r /var/cache/apk\nRUN mkdir -p /usr/src/app\nWORKDIR /usr/src/app\nCOPY package.json /usr/src/app/\nRUN npm i  --registry=https://registry.npm.taobao.org --production\n# RUN npm i\nCOPY . /usr/src/app\n# COPY ./ /usr/src/app\n# COPY . .\n#ADD ./ ./\nEXPOSE 8001\n# ENTRYPOINT [ "npm", "start" ]\n# CMD npm start\nCMD npm run docker\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br")])]),e("p",[s._v(".dockerignore")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v(".git\n.idea/\n.vscode/\nnode_modules/\nlogs/\nrun/\ntest/\ndocker/\ntypings/\n.dockerignore\nDockerfile\nREADME.md\nREADME.zh-CN.md\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br")])]),e("p",[s._v("反向设置处理:[推荐]")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("*\n!app/\n!config/\n!lib/\n!pem/\n!app.js\n!package.json\n!.sequelizerc\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br")])]),e("blockquote",[e("p",[e("a",{attrs:{href:"https://stackoverflow.com/questions/28097064/dockerignore-ignore-everything-except-a-file-and-the-dockerfile",target:"_blank",rel:"noopener noreferrer"}},[s._v("Dockerignore: Ignore everything except a file and the Dockerfile"),e("OutboundLink")],1)])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("# Ignore everything\n**\n# Allow files and directories\n!/file.txt\n!/src/**\n# Ignore unnecessary files inside allowed directories\n# This should go after the allowed directories\n**/*~\n**/*.log\n**/.DS_Store\n**/Thumbs.db\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br")])]),e("p",[s._v("注意这里全部拷贝和部分拷贝;")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("COPY package.json /usr/src/app/\nRUN npm i  --registry=https://registry.npm.taobao.org --production\n# RUN npm i\n# COPY . . # 全部拷贝,跟.dockerignore配合使用;\nADD app app # 部分拷贝,不用配置.dockerignore,指定目录就可以,但是要拷贝的目录多了了话,会影响大小;\nADD config config # 可以考虑,这一句跟上面一句合并处理;\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("p",[s._v("volumes处理时,可以通过这个简单的处理,不用写脚本:")]),s._v(" "),e("p",[s._v("$PWD 当前文件夹")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v(' nginx:\n        image: nginx:latest\n        # 端口映射\n        ports:\n            - "80:80"\n        # 依赖关系 先跑php\n        depends_on:\n            - "php"\n        # 数据卷\n        volumes:\n            # 映射主机./conf.d目录到容器/etc/nginx/conf.d目录\n            - "$PWD/conf.d:/etc/nginx/conf.d"\n            - "$PWD/html:/usr/share/nginx/html"\n        networks:\n            - app_net\n        # 容器名称\n        container_name: "compose-nginx"\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br")])]),e("hr"),s._v(" "),e("p",[e("strong",[s._v("docker-compose处理部分")])]),s._v(" "),e("p",[s._v("docker-compose.yml.bak")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("version: '2.2'\nservices:\n  egg:\n    build: ./\n    image: egg\n    ports:\n      - 7001:7001            \n    networks:\n      - docker_egg\n  mysql:\n      image: mysql:5.7.13\n      restart: always\n      ports:\n          - 3306:3306\n      volumes:\n          - ./data:/var/lib/mysql\n      environment:\n          - MYSQL_ROOT_PASSWORD=mysql\n    networks:\n      - docker_egg        \n          \nnetworks:\n  docker_egg:\n    driver: bridge  \n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br")])]),e("p",[e("strong",[s._v("pay-micro项目")])]),s._v(" "),e("p",[s._v("启动脚本及docker-compose脚本:")]),s._v(" "),e("p",[s._v("start.sh")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("#!/bin/bash\n# 使用说明:\n# 启动脚本:sudo bash ./docker/build.sh\nsudo docker build -t pay-micro -f docker/Dockerfile .\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("p",[s._v("build.sh")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("#!/bin/bash\n# 使用说明:\n# 启动脚本:sudo bash ./docker/start.sh\nsudo mkdir -p /srv/pay-micro/config/\nsudo cp ./docker/config/config.prod.js /srv/pay-micro/config/config.prod.js\nsudo docker-compose -p pay-micro-compose -f docker/docker-compose.yml rm -f\nsudo docker-compose -p pay-micro-compose -f docker/docker-compose.yml up -d\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br")])]),e("p",[s._v("Dockerfile")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('FROM node:10-alpine\nRUN apk --update add tzdata \\\n    && cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime \\\n    && echo "Asia/Shanghai" > /etc/timezone \\\n    && apk del tzdata\nRUN apk add curl bash tree && \\\n    rm -r /usr/share/man && \\\n    rm -r /var/cache/apk\nRUN mkdir -p /usr/src/app\nWORKDIR /usr/src/app\nCOPY package.json /usr/src/app/\nRUN npm i  --registry=https://registry.npm.taobao.org --production\nCOPY . .\n   \nEXPOSE 7004\nCMD npm run docker\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br")])]),e("p",[s._v("docker-compose.yml")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("version: '2.2'\nservices:\n  mongodb:\n    image: mongo:3.4\n    ports:\n        - 27084:27017\n    volumes:\n        - /srv/pay-micro/mongodb:/data/db\n    networks:\n      - docker_egg    \n    restart: always\n  pay-micro:\n    depends_on:\n      - mongodb\n    image: pay-micro\n    ports:\n      - 7084:7004\n    volumes:\n      - /srv/pay-micro/uploads:/usr/src/app/uploads\n      - /srv/pay-micro/config/config.prod.js:/usr/src/app/config/config.prod.js           \n    networks:\n      - docker_egg\n    restart: always\n          \nnetworks:\n  docker_egg:\n    driver: bridge  \n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br")])]),e("p",[e("strong",[s._v("pay-micro项目")])]),s._v(" "),e("p",[e("strong",[s._v("跟pay类似,就是添加了redis及跟主项目cms有关联;")])]),s._v(" "),e("p",[s._v("启动脚本及docker-compose脚本:")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v(" redis:\n    image: redis:5.0-alpine\n    volumes:\n      - /srv/neocloud-statistics/redis:/data\n    networks:\n      - docker_egg\n    restart: always\n    \n      depends_on:\n      - redis\n      - mongodb\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br")])]),e("p",[e("strong",[s._v("book_server项目")])]),s._v(" "),e("p",[e("strong",[s._v("项目依赖graphicsmagick书本封面处理库;Dockerfile得配置安装库;")])]),s._v(" "),e("p",[e("strong",[s._v("只有项目自己,本来是可以直接用dockerfile就可以处理,但考虑到文件路径映射.还是用docker-copose.yml处理;")])]),s._v(" "),e("p",[s._v("启动脚本及docker-compose脚本:")]),s._v(" "),e("p",[s._v("Dockerfile安装graphicsmagick库:")]),s._v(" "),e("p",[s._v("方式一: as gm的方式有问题,最后直接安装alpine-node-imagemagick,但是这种加载方式推荐;")]),s._v(" "),e("p",[s._v("https://hub.docker.com/r/jameskyburz/graphicsmagick-alpine/dockerfile")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("FROM jameskyburz/graphicsmagick-alpine:v3.0.0 as gm\nFROM node:10-alpine\n# RUN apk add --no-cache imagemagick graphicsmagick\nCOPY --from=gm /usr/ /usr/\n# FROM mmarcant/alpine-node-imagemagick\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("p",[s._v("mmarcant/alpine-node-imagemagick 的Dockerfile")]),s._v(" "),e("p",[s._v("多了个ffmpeg库;")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('# Start from base node alpine image\nFROM node:10-alpine\n# install imagemagick, graphicsmagick, ffmgeg and\nRUN apk add --no-cache imagemagick ffmpeg graphicsmagick\n# install bash\nRUN apk add --no-cache bash\n# try fix\nRUN ln -s /bin/sh /bin/source\nENTRYPOINT ["/bin/sh", "-c"]\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br")])]),e("p",[s._v("方式二:")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("# FROM jameskyburz/graphicsmagick-alpine:v3.0.0 as gm\nFROM node:10-alpine\n# FROM mmarcant/alpine-node-imagemagick\nRUN apk add --no-cache imagemagick graphicsmagick\n# COPY --from=gm /usr/ /usr/\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("version: '2.2'\nservices:\n  book_server:\n   #image: book_server\n    container_name: book_server\n    build:\n      context: ../\n      dockerfile: ./docker/Dockerfile\n      args:\n         t: 'book_server'\n    ports:\n      - 7005:7005\n    volumes:\n      - /srv/book_server/uploads:/usr/src/app/uploads\n      - /srv/book_server/config/config.prod.js:/usr/src/app/config/config.prod.js \n      - /srv/book_server/book_epubs:/root/srv/book_server \n    networks:\n      - docker_egg\n    restart: always\n          \nnetworks:\n  docker_egg:\n    driver: bridge  \n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br")])]),e("p",[s._v("#image: book_server")]),s._v(" "),e("p",[s._v("container_name: book_server")]),s._v(" "),e("p",[s._v("build:")]),s._v(" "),e("p",[s._v("context: ../")]),s._v(" "),e("p",[s._v("dockerfile: ./docker/Dockerfile")]),s._v(" "),e("p",[s._v("一起处理Dockerfile,不用再去触发build.sh打包容器,其再次启动;")]),s._v(" "),e("p",[s._v("缺点就是不能控制生成book_server 镜像的项目名字,不利于复用;")]),s._v(" "),e("p",[s._v("最后通过参数处理:t: 'book_server',发现没有用;")]),s._v(" "),e("p",[s._v("最后可以通过container_name: book_server配置,及不要配置docker-compose -p 设置name就可以;")]),s._v(" "),e("p",[s._v("也还是不可以;")]),s._v(" "),e("p",[s._v("最最后,还是回归到这里的;直接配置image就可以;")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("  build: ./pay-micro  # image指定build Dockerfile生成镜像的名称  image: pay-micro:1.0\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("其名字变为:bookservercompose_book_server\n之前期望名字为: sudo docker build -t book_server -f docker/Dockerfile .\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v(" book_server:\n    image: book_server\n    #container_name: book_server\n    build:\n      context: ../\n      dockerfile: ./docker/Dockerfile\n      args:\n        buildno: 1\n    ports:\n      - 7005:7005\n    volumes:\n      - /srv/book_server/uploads:/usr/src/app/uploads\n      - /srv/book_server/config/config.prod.js:/usr/src/app/config/config.prod.js \n      - /srv/book_server/book_epubs:/root/srv/book_server \n    networks:\n      - docker_egg\n    restart: always\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br")])]),e("p",[s._v("得找个命名去重新触发book_server镜像重新编译:")]),s._v(" "),e("p",[s._v("docker-compose build")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("Successfully tagged bookservercompose_book_server:latest\nWARNING: Image for service book_server was built because it did not already exist. To rebuild this image you must use `docker-compose build` or `docker-compose up --build`.\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[e("strong",[s._v("onyx_drm项目")])]),s._v(" "),e("p",[e("strong",[s._v("项目依赖java命令,linux安装openJDK8版本;Dockerfile得配置安装库;")])]),s._v(" "),e("p",[e("strong",[s._v("因drm.jar是在1.8版本环境下编译的,使用得配置安装;")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("# add other lib\nRUN apk update && \\\n  apk upgrade && \\\n  apk add openjdk8 && \\\n  rm -r /usr/share/man && \\\n  rm -rf /var/cache/apk/*\nENV JAVA_HOME /usr/lib/jvm/java-1.8-openjdk\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br")])]),e("p",[s._v("docker-compose.yml")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("version: '2.2'\nservices:\n  onyx_drm:\n   #image: onyx_drm\n    container_name: onyx_drm\n    build:\n      context: ../\n      dockerfile: ./docker/Dockerfile\n    ports:\n      - 7003:7003\n    volumes:\n      - /srv/onyx_drm/uploads:/usr/src/app/uploads\n      - /srv/onyx_drm/config/config.prod.js:/usr/src/app/config/config.prod.js\n      - /srv/onyx_drm/libs:/root/.onyx/libs # 因涉及到加密,先提前拷贝的libs目录\n    networks:\n      - docker_egg\n    restart: always\n          \nnetworks:\n  docker_egg:\n    driver: bridge  \n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br")])]),e("p",[s._v("start.sh")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("#!/bin/bash\n# 使用说明:\n# 启动脚本:sudo bash ./docker/start.sh\nsudo mkdir -p /srv/onyx_drm/config/\n# sudo cp /lib/drm.jar /srv/onyx_drm/libs/\nsudo cp ./docker/config/config.prod.js /srv/onyx_drm/config/config.prod.js\nsudo docker-compose -f docker/docker-compose.yml rm -f\nsudo docker-compose -p onyx_drm-compose -f docker/docker-compose.yml up -d\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br")])]),e("p",[e("strong",[s._v("neocloud项目")])]),s._v(" "),e("p",[e("strong",[s._v("项目依赖pdftk,openJDK8, 加载在线的git库下载(要用https方式),得安装git相关库;")])]),s._v(" "),e("p",[e("strong",[s._v('"egg-passport-wechat": "https://github.com:jige666/egg-passport-wechat.git",及本地父目录加载处理;(做多层处理)"onyx-alioss": "../onyx_alioss",')])]),s._v(" "),e("p",[e("strong",[s._v("volumes映射目录也记得修改:")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("    volumes:\n      - /srv/neocloud/logs:/root/logs\n      - /srv/neocloud/uploads:/usr/src/app/neocloud/uploads\n      - /srv/neocloud/config/config.json:/usr/src/app/neocloud/database/config.json\n      - /srv/neocloud/config/config.prod.js:/usr/src/app/neocloud/config/config.prod.js\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('FROM node:10-alpine\nRUN apk --update add tzdata \\\n    && cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime \\\n    && echo "Asia/Shanghai" > /etc/timezone \\\n    && apk del tzdata\nRUN apk --update add curl bash tree && \\\n    apk add openssh git && \\\n    rm -r /usr/share/man && \\\n    rm -r /var/cache/apk\n#RUN apk --update add curl bash tree && \\\n#    apk add openssh git && \\\n        \nRUN mkdir -p /usr/src/app\nWORKDIR /usr/src/app\nCOPY tmp /usr/src/app/onyx_alioss\n# COPY package.json /usr/src/app/\n# COPY . .\nCOPY package.json /usr/src/app/neocloud/\nCOPY . ./neocloud/\nRUN cd /usr/src/app/neocloud && npm i  --registry=https://registry.npm.taobao.org --production\n   \nEXPOSE 7002\nCMD cd neocloud && npm run docker\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br")])]),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("CMD cd neocloud && \\\n    NODE_ENV=production npx sequelize db:migrate && \\\n    npx sequelize db:seed:all && \\\n    npm run docker\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("p",[e("strong",[s._v("node-pdftk https://hub.docker.com/r/r3ddox/node-pdftk/dockerfile")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("FROM node:10-alpine\nRUN apk update && apk upgrade && apk add --no-cache \\\n    alpine-sdk \\\n    python \\\n    pdftk \\\n    ocaml \\\n    libelf-dev\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br")])]),e("p",[s._v("Dockerfile除安装calibredb安装配置好的版本:")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('FROM node:10-alpine\nRUN apk --update add tzdata \\\n    && cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime \\\n    && echo "Asia/Shanghai" > /etc/timezone \\\n    && apk del tzdata\nRUN apk --update add curl bash tree && \\\n    apk add openssh git && \\\n    rm -r /usr/share/man && \\\n    rm -r /var/cache/apk\nRUN mkdir -p /usr/src/app\nWORKDIR /usr/src/app\nCOPY tmp /usr/src/app/onyx_alioss\nCOPY package.json /usr/src/app/neocloud/\nCOPY . ./neocloud/\nRUN cd /usr/src/app/neocloud && npm i  --registry=https://registry.npm.taobao.org --production\n# RUN NODE_ENV=production npx sequelize db:migrate && npx sequelize db:seed:all\nEXPOSE 7002\n # NODE_ENV=production npx sequelize db:migrate && \\\n # NODE_ENV=production npx sequelize db:seed:all && \\\nCMD cd neocloud && \\\n    npm run docker\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br")])])])}),[],!1,null,null,null);n.default=r.exports}}]);