(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{565:function(s,a,t){s.exports=t.p+"assets/img/image-20220520100642910.c78376b1.png"},566:function(s,a,t){s.exports=t.p+"assets/img/image-20220520153930797.c5e44358.png"},567:function(s,a,t){s.exports=t.p+"assets/img/image-20220520134701111.9feb76af.png"},568:function(s,a,t){s.exports=t.p+"assets/img/wps2.27064f4e.jpg"},569:function(s,a,t){s.exports=t.p+"assets/img/wps3.85bb20a3.jpg"},570:function(s,a,t){s.exports=t.p+"assets/img/wps4.63606304.jpg"},571:function(s,a,t){s.exports=t.p+"assets/img/wps5.f4959693.jpg"},572:function(s,a,t){s.exports=t.p+"assets/img/wps6.d6fb030e.jpg"},573:function(s,a,t){s.exports=t.p+"assets/img/image-20220607105315782.a56f1185.png"},574:function(s,a,t){s.exports=t.p+"assets/img/image-20220520173259317.7e066355.png"},575:function(s,a,t){s.exports=t.p+"assets/img/image-20210726101544141.43339741.png"},576:function(s,a,t){s.exports=t.p+"assets/img/image-20210726135133819.5a761261.png"},577:function(s,a,t){s.exports=t.p+"assets/img/image-20210726105430879.0fc0021f.png"},578:function(s,a,t){s.exports=t.p+"assets/img/image-20210302181407722.fdc22d8f.png"},579:function(s,a,t){s.exports=t.p+"assets/img/image-20210726134249068.7568e8c8.png"},580:function(s,a,t){s.exports=t.p+"assets/img/image-20210302133411795.43c0668c.png"},581:function(s,a,t){s.exports=t.p+"assets/img/image-20210726141459318.b05d347e.png"},582:function(s,a,t){s.exports=t.p+"assets/img/image-20210301151056577.fd028e0b.png"},583:function(s,a,t){s.exports=t.p+"assets/img/image-20210726112101073.5186ba1f.png"},584:function(s,a,t){s.exports=t.p+"assets/img/image-20210301151624044.d03b6f23.png"},585:function(s,a,t){s.exports=t.p+"assets/img/wps9.54cec5b1.jpg"},586:function(s,a,t){s.exports=t.p+"assets/img/wps10.3e5719b9.jpg"},587:function(s,a,t){s.exports=t.p+"assets/img/wps11.272ae6d9.jpg"},588:function(s,a,t){s.exports=t.p+"assets/img/wps12.316228a6.jpg"},589:function(s,a,t){s.exports=t.p+"assets/img/wps13.fb158ea4.jpg"},783:function(s,a,t){"use strict";t.r(a);var e=t(31),n=Object(e.a)({},(function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h2",{attrs:{id:"clickhouse包准备"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#clickhouse包准备"}},[s._v("#")]),s._v(" clickhouse包准备")]),s._v(" "),e("h3",{attrs:{id:"单独命令安装"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#单独命令安装"}},[s._v("#")]),s._v(" 单独命令安装")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" yum "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y yum-utils\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" yum-config-manager --add-repo https://packages.clickhouse.com/rpm/clickhouse.repo\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" yum "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y clickhouse-server clickhouse-client\n\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" /etc/init.d/clickhouse-server start\nclickhouse-client "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# or "clickhouse-client --password" if you set up a password.')]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("h3",{attrs:{id:"提前离线下载包"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#提前离线下载包"}},[s._v("#")]),s._v(" 提前离线下载包")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("yumdownloader --downloadonly clickhouse-server clickhouse-client\n\nroot@host116"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("/var/www/html/files/ckman/clickhouse"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ls -lh")]),s._v("\n总用量 120K\n-rw-r--r-- "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(".4K "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("月   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v(" clickhouse-client-1.1.54385-2.x86_64.rpm\n-rw-r--r-- "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root  31K "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("月  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(":51 clickhouse-client-22.2.2.1-2.noarch.rpm\n-rw-r--r-- "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root  21K "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("月   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v(" clickhouse-server-1.1.54385-2.x86_64.rpm\n-rw-r--r-- "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root  55K "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("月  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(":51 clickhouse-server-22.2.2.1-2.noarch.rpm\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br")])]),e("h2",{attrs:{id:"ckman介绍"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#ckman介绍"}},[s._v("#")]),s._v(" Ckman介绍")]),s._v(" "),e("p",[e("code",[s._v("ckman")]),s._v("，全称是"),e("code",[s._v("ClickHouse Management Console")]),s._v("， 即"),e("code",[s._v("ClickHouse")]),s._v("管理平台。它是由擎创科技数据库团队主导研发的一款用来管理和监控"),e("code",[s._v("ClickHouse")]),s._v("集群的可视化运维工具。目前该工具已在"),e("code",[s._v("github")]),s._v("上开源，开源地址为："),e("a",{attrs:{href:"https://github.com/housepower/ckman",target:"_blank",rel:"noopener noreferrer"}},[s._v("github.com/housepower/ckman"),e("OutboundLink")],1),s._v("。")]),s._v(" "),e("h3",{attrs:{id:"为什么要有ckman"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#为什么要有ckman"}},[s._v("#")]),s._v(" 为什么要有ckman")]),s._v(" "),e("p",[s._v("我们不妨思考一下这样的场景：如果要部署一个"),e("code",[s._v("ClickHouse")]),s._v("集群，需要怎么做？")]),s._v(" "),e("ul",[e("li",[e("p",[s._v("首先，我们需要在所有"),e("code",[s._v("ClickHouse")]),s._v("节点上安装"),e("code",[s._v("ClickHouse")]),s._v("的"),e("code",[s._v("rpm")]),s._v("包，然后，需要修改配置文件，包括但不限于"),e("code",[s._v("config.xml")]),s._v("、"),e("code",[s._v("users.xml")]),s._v("、"),e("code",[s._v("metrika.xml")]),s._v("。注意，是所有节点上都要修改，修改完成后需要依次启动各个节点。")]),s._v(" "),e("p",[s._v("当集群规模不大，这些操作手动去完成可能不觉得有什么，但是如果集群规模比较大，单个集群的节点达到了上百台甚至上千台，这时候要手工去每台机器上去操作，显然变得不太现实。")])]),s._v(" "),e("li",[e("p",[s._v("如果需要往集群增加一个节点呢？")]),s._v(" "),e("p",[s._v("我们需要在已有的节点上的"),e("code",[s._v("metrika.xml")]),s._v("配置文件中加上该节点，然后在新增节点上安装"),e("code",[s._v("rpm")]),s._v("包，修改"),e("code",[s._v("metrika.xml")]),s._v("，启动"),e("code",[s._v("ClickHouse")]),s._v("服务，最后还要同步其他节点上的"),e("code",[s._v("schema")]),s._v("表结构，至此才能完成。")])]),s._v(" "),e("li",[e("p",[s._v("删除节点亦如是。")]),s._v(" "),e("p",[s._v("如果要升级集群呢？我们不仅需要在每个节点上重新安装升级"),e("code",[s._v("rpm")]),s._v("包，还需要考虑一些其他的问题：需不需要停服务？如果升级失败了怎么办？")])])]),s._v(" "),e("p",[s._v("总之，"),e("code",[s._v("ClickHouse")]),s._v("的集群运维，如果靠人工去做，不仅繁琐，容易出现各种问题，当集群规模变大后，也变得不切实际。")]),s._v(" "),e("p",[s._v("这时候，"),e("code",[s._v("ckman")]),s._v("的出现，就可以完美解决上述的问题。"),e("code",[s._v("ckman")]),s._v("将这些运维操作都集成在管理界面中，用户只需要在"),e("code",[s._v("web")]),s._v("界面上通过简单的信息配置，点击鼠标，就可以完成所有的配置工作，而无需关注其他细节，也减少了出错的可能。")]),s._v(" "),e("h3",{attrs:{id:"ckman能做什么"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#ckman能做什么"}},[s._v("#")]),s._v(" ckman能做什么")]),s._v(" "),e("p",[e("code",[s._v("ckman")]),s._v("主要的功能是管理和监控"),e("code",[s._v("ClickHouse")]),s._v("集群。因此，它的操作对象只能是"),e("code",[s._v("ClickHouse")]),s._v("集群，而不是单个"),e("code",[s._v("ClickHouse")]),s._v("节点。")]),s._v(" "),e("h4",{attrs:{id:"管理clickhouse集群"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#管理clickhouse集群"}},[s._v("#")]),s._v(" 管理ClickHouse集群")]),s._v(" "),e("ul",[e("li",[s._v("部署"),e("code",[s._v("ClickHouse")]),s._v("集群")]),s._v(" "),e("li",[s._v("导入"),e("code",[s._v("ClickHouse")]),s._v("集群")]),s._v(" "),e("li",[s._v("升级"),e("code",[s._v("ClickHouse")]),s._v("集群")]),s._v(" "),e("li",[s._v("增加或删除集群节点")]),s._v(" "),e("li",[s._v("对集群（或节点）进行启停")]),s._v(" "),e("li",[s._v("实现数据再均衡")])]),s._v(" "),e("h4",{attrs:{id:"监控clickhouse集群"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#监控clickhouse集群"}},[s._v("#")]),s._v(" 监控ClickHouse集群")]),s._v(" "),e("ul",[e("li",[s._v("监控"),e("code",[s._v("ClickHouse Query")])]),s._v(" "),e("li",[s._v("监控节点系统性能指标（"),e("code",[s._v("CPU")]),s._v("，"),e("code",[s._v("Memory")]),s._v("， "),e("code",[s._v("IO")]),s._v("等）")]),s._v(" "),e("li",[s._v("监控"),e("code",[s._v("Zookeeper")]),s._v("相关指标")]),s._v(" "),e("li",[s._v("监控集群分布式表相关指标")]),s._v(" "),e("li",[s._v("监控副本状态相关指标")]),s._v(" "),e("li",[s._v("监控慢"),e("code",[s._v("SQL")]),s._v("等相关指标")])]),s._v(" "),e("h2",{attrs:{id:"源码编译ckman"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#源码编译ckman"}},[s._v("#")]),s._v(" 源码编译ckman")]),s._v(" "),e("h3",{attrs:{id:"编译依赖"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#编译依赖"}},[s._v("#")]),s._v(" 编译依赖")]),s._v(" "),e("p",[s._v("由于"),e("code",[s._v("ckman")]),s._v("使用"),e("code",[s._v("golang")]),s._v("实现，因此需要提前安装"),e("code",[s._v("go")]),s._v("(请使用"),e("code",[s._v(">=1.17")]),s._v("版本)；")]),s._v(" "),e("p",[s._v("如果需要编译成"),e("code",[s._v("rpm")]),s._v("包或"),e("code",[s._v("deb")]),s._v("包，需要安装"),e("code",[s._v("nfpm")]),s._v(":")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" -q https://github.com/goreleaser/nfpm/releases/download/v2.15.1/nfpm_2.15.1_Linux_x86_64.tar.gz \n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" -xzvf nfpm_2.15.1_Linux_x86_64.tar.gz \n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" nfpm /usr/local/bin\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("p",[s._v("如果有编译前端的需求，需要安装"),e("code",[s._v("node.js")]),s._v("；可使用如下命令安装：")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" -q https://nodejs.org/download/release/v14.15.3/node-v14.15.3-linux-x64.tar.gz \n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" -xzf node-v14.15.3-linux-x64.tar.gz -C /usr/local/ \n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("ln")]),s._v(" -s /usr/local/node-v14.15.3-linux-x64/bin/node /usr/local/bin \n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("ln")]),s._v(" -s /usr/local/node-v14.15.3-linux-x64/bin/npm /usr/local/bin\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("ln")]),s._v(" -s /usr/local/node-v14.15.3-linux-x64/bin/yarn /usr/local/bin\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("h3",{attrs:{id:"编译命令"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#编译命令"}},[s._v("#")]),s._v(" 编译命令")]),s._v(" "),e("h4",{attrs:{id:"tar-gz包编译"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#tar-gz包编译"}},[s._v("#")]),s._v(" tar.gz包编译")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" package "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("VERSION")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("x.x.x   \n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("以上命令会编译成打包成一个"),e("code",[s._v("tar.gz")]),s._v("安装包，该安装包解压即可用。")]),s._v(" "),e("p",[e("code",[s._v("VERSION")]),s._v("是指定的版本号，如果不指定，则默认取"),e("code",[s._v("git describe --tags --dirty")]),s._v("的结果作为版本号。")]),s._v(" "),e("h4",{attrs:{id:"rpm包编译"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#rpm包编译"}},[s._v("#")]),s._v(" rpm包编译")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("rpm")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("VERSION")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("x.x.x\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h4",{attrs:{id:"docker编译"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#docker编译"}},[s._v("#")]),s._v(" docker编译")]),s._v(" "),e("p",[s._v("鉴于编译环境的诸多依赖，配置起来可能比较麻烦，因此也提供了"),e("code",[s._v("docker")]),s._v("编译的方式，直接运行下面的命令即可：")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" docker-build "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("VERSION")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("x.x.x\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("如果想利用"),e("code",[s._v("docker")]),s._v("编译"),e("code",[s._v("rpm")]),s._v("版本，可以先进入"),e("code",[s._v("docker")]),s._v("环境，再编译：")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" docker-sh\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("rpm")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("VERSION")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("x.x.x\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("h4",{attrs:{id:"前端单独编译"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#前端单独编译"}},[s._v("#")]),s._v(" 前端单独编译")]),s._v(" "),e("p",[s._v("为了减少编译上的麻烦，"),e("code",[s._v("ckman")]),s._v("代码已经将前端代码编译好，做成静态链接放在"),e("code",[s._v("static/dist")]),s._v("目录下，但是仍然将前端代码以"),e("code",[s._v("submodule")]),s._v("的形式嵌入在"),e("code",[s._v("frontend")]),s._v("目录下，如果想要自己编译前端，在提前安装好前端编译依赖后，可以使用如下命令：")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" frontend\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("yarn")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" frontend\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("h2",{attrs:{id:"工具部署"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#工具部署"}},[s._v("#")]),s._v(" 工具部署")]),s._v(" "),e("ul",[e("li",[e("code",[s._v("prometheus")]),s._v("(非必需)")]),s._v(" "),e("li",[e("code",[s._v("node_exporter")]),s._v("(非必需)")]),s._v(" "),e("li",[e("code",[s._v("nacos")]),s._v("(>"),e("code",[s._v("1.4")]),s._v(")(非必需)")]),s._v(" "),e("li",[e("code",[s._v("zookeeper")]),s._v("(>"),e("code",[s._v("3.6.0")]),s._v(", 推荐 )")]),s._v(" "),e("li",[e("code",[s._v("mysql")]),s._v(" (当持久化策略设置为"),e("code",[s._v("mysql")]),s._v("时必需)")])]),s._v(" "),e("h3",{attrs:{id:"架构原理图"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#架构原理图"}},[s._v("#")]),s._v(" 架构原理图")]),s._v(" "),e("p",[e("img",{attrs:{src:t(565),alt:"image-20220520100642910"}})]),s._v(" "),e("h3",{attrs:{id:"监控相关安装及配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#监控相关安装及配置"}},[s._v("#")]),s._v(" 监控相关安装及配置")]),s._v(" "),e("h4",{attrs:{id:"zookeeper安装及配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#zookeeper安装及配置"}},[s._v("#")]),s._v(" zookeeper安装及配置")]),s._v(" "),e("p",[s._v("推荐安装3.6.0以上，"),e("strong",[s._v("必须使用3.5以上的版本")]),s._v("，需要通过Zookeeper AdminServer的端口获取;")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#wget https://dlcdn.apache.org/zookeeper/zookeeper-3.6.3/apache-zookeeper-3.6.3.tar.gz")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#tar zxvf apache-zookeeper-3.6.3.tar.gz && mv apache-zookeeper-3.6.3 zookeeper-3.6.3")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://dlcdn.apache.org/zookeeper/zookeeper-3.6.3/apache-zookeeper-3.6.3-bin.tar.gz --no-check-certificate\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" zxvf apache-zookeeper-3.6.3-bin.tar.gz "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" apache-zookeeper-3.6.3-bin zookeeper-3.6.3\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" zookeeper-3.6.3\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("p",[e("code",[s._v("zookeeper")]),s._v("集群是"),e("code",[s._v("clickhouse")]),s._v("实现分布式集群的重要组件，需要提前搭建好。由于"),e("code",[s._v("clickhouse")]),s._v("数据量极大，避免给"),e("code",[s._v("zookeeper")]),s._v("带来太大的压力，最好给"),e("code",[s._v("clickhouse")]),s._v("单独部署一套集群，不要和其他业务公用。")]),s._v(" "),e("p",[s._v("本文默认"),e("code",[s._v("zookeeper")]),s._v("集群已经搭建完成。我们需要在zk各节点的"),e("code",[s._v("zoo.cfg")]),s._v("配置文件里加上如下配置：")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("metricsProvider.className"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("org.apache.zookeeper.metrics.prometheus.PrometheusMetricsProvider\nmetricsProvider.httpPort"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("7000")]),s._v("  "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#暴露给promethues的监控端口")]),s._v("\nadmin.enableServer"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true\nadmin.serverPort"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("8086")]),s._v("   "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#暴露给四字命令如mntr等的监控端口，3.5.0以上版本支持")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("p",[s._v("完整部分：")]),s._v(" "),e("div",{staticClass:"language-properties line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-properties"}},[e("code",[e("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("mkdir")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("-p /home/wdp/ckman/zookeeper/data")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("vi")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("conf/zoo.cfg")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# The number of milliseconds of each tick")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("tickTime")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("2000")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# The number of ticks that the initial")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# synchronization phase can take")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("initLimit")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("10")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# The number of ticks that can pass between")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# sending a request and getting an acknowledgement")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("syncLimit")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("5")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# the directory where the snapshot is stored.")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# do not use /tmp for storage, /tmp here is just")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# example sakes.")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("dataDir")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("/home/wdp/ckman/zookeeper/data")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# the port at which the clients will connect")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("clientPort")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("2184")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# the maximum number of client connections.")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# increase this if you need to handle more clients")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#maxClientCnxns=60")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Be sure to read the maintenance section of the")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# administrator guide before turning on autopurge.")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# http://zookeeper.apache.org/doc/current/zookeeperAdmin.html#sc_maintenance")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# The number of snapshots to retain in dataDir")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#autopurge.snapRetainCount=3")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Purge task interval in hours")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# Set to "0" to disable auto purge feature')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#autopurge.purgeInterval=1")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## Metrics Providers")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# https://prometheus.io Metrics Exporter")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("metricsProvider.className")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("org.apache.zookeeper.metrics.prometheus.PrometheusMetricsProvider")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("metricsProvider.httpPort")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("7000")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("metricsProvider.exportJvmInfo")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("true")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("admin.enableServer")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("true")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("admin.serverPort")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("8080   #暴露给四字命令如mntr等的监控端口，3.5.0以上版本支持")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br"),e("span",{staticClass:"line-number"},[s._v("36")]),e("br"),e("span",{staticClass:"line-number"},[s._v("37")]),e("br"),e("span",{staticClass:"line-number"},[s._v("38")]),e("br"),e("span",{staticClass:"line-number"},[s._v("39")]),e("br"),e("span",{staticClass:"line-number"},[s._v("40")]),e("br")])]),e("p",[s._v("然后依次重启"),e("code",[s._v("zookeeper")]),s._v("各个节点。")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v(" ./bin/zkServer.sh  start\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[e("strong",[s._v("可能报错")])]),s._v(" "),e("blockquote",[e("h5",{attrs:{id:"错误-找不到或无法加载主类-org-apache-zookeeper-server-quorum-quorumpeermain"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#错误-找不到或无法加载主类-org-apache-zookeeper-server-quorum-quorumpeermain"}},[s._v("#")]),s._v(" 错误: 找不到或无法加载主类 org.apache.zookeeper.server.quorum.QuorumPeerMain")])]),s._v(" "),e("p",[s._v("原因分析：")]),s._v(" "),e("p",[s._v("也即是下载的是未编译的 jar 包。\n注：zookeeper 好像从 3.5 版本以后，命名就发生了改变，如果是 apache-zookeeper-3.5.5.tar.gz 这般命名的，都是未编译的，而 apache-zookeeper-3.5.5-bin.tar.gz 这般命名的，才是已编译的包。")]),s._v(" "),e("p",[e("strong",[s._v("解决方案：")]),s._v("\n重新下载 apache-zookeeper-3.5.5-bin.tar.gz 包，然后解压使用。 非bin解压出来没有lib文件加，需要将bin包解压出来;")]),s._v(" "),e("p",[e("img",{attrs:{src:t(566),alt:"image-20220520153930797"}})]),s._v(" "),e("blockquote",[e("h5",{attrs:{id:"no-snapshot-found-but-there-are-log-entries-something-is-broken"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#no-snapshot-found-but-there-are-log-entries-something-is-broken"}},[s._v("#")]),s._v(" No snapshot found, but there are log entries. Something is broken!")])]),s._v(" "),e("p",[s._v("在下载了已编译的 apache-zookeeper-3.5.5-bin.tar.gz 包并解压，且在 conf 文件夹下拷贝并重命名了一份 zoo.cfg 文件后，在启动 bin 目录下的 zkServer.cmd（Windows） 文件时依旧闪退，错误信息如下👇")]),s._v(" "),e("p",[e("strong",[s._v("原因分析：")])]),s._v(" "),e("p",[s._v("这个错是在启动zk恢复数据报错的，因为已经安装有 3.4.14 版本，且两个版本的 dirData 地址都没有修改（dataDir=/tmp/zookeeper），是同一个地址，所以数据也是 3.4.14 版本的数据，现在启动 3.5.5 恢复这个数据就报错了")]),s._v(" "),e("p",[e("strong",[s._v("解决方案：")])]),s._v(" "),e("p",[s._v("将 3.5.5 版本 conf 文件夹下的 zoo.cfg 文件中的 dataDir 地址修改一下即可。")]),s._v(" "),e("h4",{attrs:{id:"clickhouse监控配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#clickhouse监控配置"}},[s._v("#")]),s._v(" clickhouse监控配置")]),s._v(" "),e("p",[e("code",[s._v("ckman")]),s._v("部署的"),e("code",[s._v("clickhouse")]),s._v("集群默认监听了"),e("code",[s._v("9363")]),s._v("端口上报"),e("code",[s._v("metric")]),s._v("给"),e("code",[s._v("prometheus")]),s._v("，因此无需做任何配置。")]),s._v(" "),e("p",[s._v("如果集群是导入的，请确保"),e("code",[s._v("/etc/clickhouse-server/config.xml")]),s._v("中有以下配置内容：")]),s._v(" "),e("div",{staticClass:"language-xml line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-xml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("\x3c!-- Serve endpoint for Prometheus monitoring. --\x3e")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v('\x3c!--\n        endpoint - mertics path (relative to root, statring with "/")\n        port - port to setup server. If not defined or 0 than http_port used\n        metrics - send data from table system.metrics\n        events - send data from table system.events\n        asynchronous_metrics - send data from table system.asynchronous_metrics\n        status_info - send data from different component from CH, ex: Dictionaries status\n    --\x3e')]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("prometheus")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("endpoint")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("/metrics"),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("endpoint")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("port")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("9363"),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("port")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n\n        "),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("metrics")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("true"),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("metrics")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("events")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("true"),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("events")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("asynchronous_metrics")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("true"),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("asynchronous_metrics")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("status_info")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("true"),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("status_info")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("prometheus")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br")])]),e("h4",{attrs:{id:"promethus监控工具安装配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#promethus监控工具安装配置"}},[s._v("#")]),s._v(" promethus监控工具安装配置")]),s._v(" "),e("p",[s._v("下载程序："),e("code",[s._v("https://prometheus.io/download/")]),s._v("上传安装包：")]),s._v(" "),e("ul",[e("li",[s._v("prometheus-2.35.0.linux-amd64.tar.gz")]),s._v(" "),e("li",[s._v("node_exporter-1.2.2.linux-amd64.tar.gz")])]),s._v(" "),e("h5",{attrs:{id:"在管理节点安装监控的prometheus"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#在管理节点安装监控的prometheus"}},[s._v("#")]),s._v(" 在管理节点安装监控的prometheus")]),s._v(" "),e("p",[s._v("1.创建用户（所有节点，包括计算节点)")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("groupadd")]),s._v(" prometheus\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("useradd")]),s._v(" -g prometheus -m -d /var/lib/prometheus -s /sbin/nologin prometheus\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("2.解压安装包：")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" xvf prometheus-2.35.0.linux-amd64.tar.gz -C /usr/local/\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /usr/local/ "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" prometheus-2.35.0.linux-amd64/ prometheus\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("3.创建service启动脚本：")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" /usr/lib/systemd/system/prometheus.service\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("添加如下内容：")]),s._v(" "),e("div",{staticClass:"language-properties line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-properties"}},[e("code",[s._v("[Unit]\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("Description")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("prometheus")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("After")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("network.target")]),s._v("\n\n[Service]\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("Type")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("simple")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("User")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("prometheus")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("ExecStart")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("/usr/local/prometheus/prometheus --config.file=/usr/local/prometheus/prometheus.yml --storage.tsdb.path=/var/lib/prometheus --storage.tsdb.retention=15d --log.level=info")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("Restart")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("on-failure")]),s._v("\n\n[Install]\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("WantedBy")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("multi-user.target")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br")])]),e("h5",{attrs:{id:"在计算节点安装node-exporter"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#在计算节点安装node-exporter"}},[s._v("#")]),s._v(" 在计算节点安装node_exporter")]),s._v(" "),e("blockquote",[e("p",[e("code",[s._v("node_exporter")]),s._v("是用来监控"),e("code",[s._v("clickhouse")]),s._v("节点所在机器的一些系统指标的一款工具，因此需要安装在"),e("code",[s._v("ck")]),s._v("节点所在的机器，默认监听"),e("code",[s._v("9100")]),s._v("端口。")])]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" xvf node_exporter-1.3.1.linux-amd64.tar.gz -C /usr/local/\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /usr/local/ "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" node_exporter-1.3.1.linux-amd64/ node_exporter\n \n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" -R prometheus.prometheus node_exporter/\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("p",[s._v("创建启动脚本")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("vi /usr/lib/systemd/system/node_exporter.service\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("添加如下内容：")]),s._v(" "),e("div",{staticClass:"language-properties line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-properties"}},[e("code",[s._v("[Unit]\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("Description")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("node_export")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("Documentation")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("https://github.com/prometheus/node_exporter")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("After")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("network.target")]),s._v("\n\n[Service]\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("Type")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("simple ")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("User")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("prometheus")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("ExecStart")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("/usr/local/node_exporter/node_exporter")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("Restart")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("on-failure")]),s._v("\n\n[Install]\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("WantedBy")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("multi-user.target  ")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br")])]),e("p",[s._v("启动node_exporter")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("systemctl "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" node_exporter.service\nsystemctl start node_exporter.service\nsystemctl status node_exporter.service\nss -tnl "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("9100")]),s._v(" \n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("h5",{attrs:{id:"配置prometheus添加监控目标"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#配置prometheus添加监控目标"}},[s._v("#")]),s._v(" "),e("strong",[s._v("配置Prometheus添加监控目标")])]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" /usr/local/prometheus/prometheus.yml\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /usr/local/prometheus/prometheus.yml")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("配置以下信息：")]),s._v(" "),e("div",{staticClass:"language-yaml line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# my global config")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("global")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("scrape_interval")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 15s "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Set the scrape interval to every 15 seconds. Default is every 1 minute.")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("evaluation_interval")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 15s "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Evaluate rules every 15 seconds. The default is every 1 minute.")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# scrape_timeout is set to the global default (10s).")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Alertmanager configuration")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("alerting")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("alertmanagers")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("static_configs")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("targets")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# - alertmanager:9093")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Load rules once and periodically evaluate them according to the global 'evaluation_interval'.")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("rule_files")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# - "first_rules.yml"')]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# - "second_rules.yml"')]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# A scrape configuration containing exactly one endpoint to scrape:")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Here it's Prometheus itself.")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("scrape_configs")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# The job name is added as a label `job=<job_name>` to any timeseries scraped from this config.")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("job_name")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"prometheus"')]),s._v("\n\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# metrics_path defaults to '/metrics'")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# scheme defaults to 'http'.")]),s._v("\n\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("static_configs")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("targets")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"localhost:9090"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br")])]),e("p",[s._v("参考")]),s._v(" "),e("div",{staticClass:"language-properties line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-properties"}},[e("code",[e("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("scrape_configs")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v(" # The job name is added as a label `job=<job_name>` to any timeseries scraped from this config.")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v(" -")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("job_name: 'prometheus'")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("  # metrics_path defaults to '/metrics'")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("  # scheme defaults to 'http'.")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("  static_configs")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("  -")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("targets: ['localhost:9090','localhost:9100'] # 对本机node_exporter 监控")]),s._v("\n \n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 新添加的对其它node节点抓取数据")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v(" -")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("job_name: '111.4'")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("  #重写了全局抓取间隔时间，由15秒重写成5秒。")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("  scrape_interval")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("5s")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("  static_configs")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("  -")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("targets: ['host120:9100','host121:9100']")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br")])]),e("p",[s._v("集群其他参考配置：")]),s._v(" "),e("div",{staticClass:"language-properties line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-properties"}},[e("code",[e("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("-")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("job_name: 'node_exporter'")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("  scrape_interval")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("10s")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("  static_configs")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("  -")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("targets: ['192.168.0.1:9100', '192.168.0.2:9100', '192.168.0.3:9100', '192.168.0.4:9100']")]),s._v("\n \n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("-")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("job_name: 'clickhouse'")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("  scrape_interval")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("10s")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("  static_configs")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("  -")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("targets: ['192.168.0.1:9363', '192.168.0.2:9363', '192.168.0.3:9363', '192.168.0.4:9363']")]),s._v("\n \n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("-")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("job_name: 'zookeeper'")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("  scrape_interval")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("10s")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("  static_configs")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("  -")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("targets: ['192.168.0.1:7070', '192.168.0.2:7070', '192.168.0.3:7070']")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br")])]),e("h5",{attrs:{id:"启动prometheus服务"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#启动prometheus服务"}},[s._v("#")]),s._v(" "),e("strong",[s._v("启动Prometheus服务")])]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" -R prometheus.prometheus prometheus\n\nsystemctl "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" prometheus.service\nsystemctl start prometheus.service\nsystemctl status prometheus.service\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("p",[e("strong",[s._v("访问页面：")])]),s._v(" "),e("p",[s._v("访问 Prometheus WEB 查看我们定义的目标主机：http://host117:9090/targets 或者http://host117:9090/classic/targets")]),s._v(" "),e("p",[e("img",{attrs:{src:t(567),alt:"image-20220520134701111"}})]),s._v(" "),e("h3",{attrs:{id:"安装ckman"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装ckman"}},[s._v("#")]),s._v(" 安装ckman")]),s._v(" "),e("h4",{attrs:{id:"tar-gz安装启动"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#tar-gz安装启动"}},[s._v("#")]),s._v(" tar.gz安装启动")]),s._v(" "),e("p",[s._v("安装")]),s._v(" "),e("p",[s._v("可以在任意目录进行安装。安装方式为直接解压安装包即可。")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" -xzvf ckman-1.3.1-210428.Linux.x86_64.tar.gz\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("启动")]),s._v(" "),e("p",[s._v("进入"),e("code",[s._v("ckman")]),s._v("的工作目录，执行：")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" ckman\nbin/start\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("h4",{attrs:{id:"rpm安装启动"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#rpm安装启动"}},[s._v("#")]),s._v(" rpm安装启动")]),s._v(" "),e("p",[s._v("下载安装包，并且解压；最新安装包地址：https://github.com/housepower/ckman/releases")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#安装启动方式一")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://github.com/housepower/ckman/releases/download/v2.2.5/ckman-2.2.5.x86_64.rpm\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("rpm")]),s._v(" -ivh ckman-2.2.5.x86_64.rpm\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#安装完成后，在/etc/ckman目录下，会生成工作目录（日志和配置文件等都在该目录下）。")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#rpm方式安装的ckman有两种启动方式：")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#方式一：")]),s._v("\n  /usr/local/bin/ckman -c"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/etc/ckman/conf/ckman.yaml -p"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/run/ckman/ckman.pid -l"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/var/log/ckman/ckman.log -d\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#方式二：[推荐]")]),s._v("\nsystemctl start ckman\nsystemctl status ckman\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#安装启动方式二 【推荐】")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://github.com/housepower/ckman/releases/download/v2.2.5/ckman-v2.2.5-220602.Linux.amd64.tar.gz\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" -xzvf ckman-v2.2.5-220602.Linux.amd64.tar.gz\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" ckman "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" bin/start\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br")])]),e("p",[s._v("启动之后，在浏览器输入 "),e("a",{attrs:{href:"http://localhost:8808/",target:"_blank",rel:"noopener noreferrer"}},[s._v("http://localhost:8808"),e("OutboundLink")],1),s._v(" 跳出如下界面，说明启动成功：")]),s._v(" "),e("p",[e("img",{attrs:{src:t(568),alt:"img"}})]),s._v(" "),e("p",[s._v("ckman默认的登录用户为ckman，密码为Ckmanx x x。")]),s._v(" "),e("h4",{attrs:{id:"docker安装启动"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#docker安装启动"}},[s._v("#")]),s._v(" docker安装启动")]),s._v(" "),e("p",[s._v("从"),e("code",[s._v("v1.2.7")]),s._v("版本开始，"),e("code",[s._v("ckman")]),s._v("支持从"),e("code",[s._v("docker")]),s._v("镜像启动。启动命令如下所示：")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("docker run -itd -p "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("8808")]),s._v(":8808 --restart unless-stopped --name ckman quay.io/housepower/ckman:latest\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("但是需要注意的是，搭建"),e("code",[s._v("promethues")]),s._v("和"),e("code",[s._v("nacos")]),s._v("并不属于"),e("code",[s._v("ckman")]),s._v("程序自身的范畴，因此，从容器启动"),e("code",[s._v("ckman")]),s._v("默认是关闭"),e("code",[s._v("nacos")]),s._v("的，且前台"),e("code",[s._v("Overview")]),s._v("监控不会正常显示。")]),s._v(" "),e("p",[s._v("如果想自己配置"),e("code",[s._v("nacos")]),s._v("和"),e("code",[s._v("prometheus")]),s._v("，可以进入容器自行配置。")]),s._v(" "),e("h3",{attrs:{id:"升级ckman"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#升级ckman"}},[s._v("#")]),s._v(" 升级ckman")]),s._v(" "),e("p",[e("code",[s._v("ckman")]),s._v("支持"),e("code",[s._v("rpm")]),s._v("安装和"),e("code",[s._v("tar.gz")]),s._v("安装，所以升级也针对这两种安装方式做了区分。")]),s._v(" "),e("h4",{attrs:{id:"rpm升级"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#rpm升级"}},[s._v("#")]),s._v(" rpm升级")]),s._v(" "),e("p",[s._v("从"),e("code",[s._v("github")]),s._v("上下载最新版的"),e("code",[s._v("ckman")]),e("a",{attrs:{href:"https://github.com/housepower/ckman/releases",target:"_blank",rel:"noopener noreferrer"}},[s._v("安装包"),e("OutboundLink")],1),s._v("。 停止"),e("code",[s._v("ckman")]),s._v("服务：")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("systemctl stop ckman\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#yum remove -y ckman")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#几个常用的目录")]),s._v("\n/etc/ckman\n/etc/clickhouse-server\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br")])]),e("p",[s._v("升级"),e("code",[s._v("rpm")]),s._v("包：")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("rpm")]),s._v("  -Uvh ckman-x.x.x-x86_64.rpm\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("注意"),e("code",[s._v("rpm")]),s._v("升级配置文件仍然会使用旧版本的，默认的配置文件会重命名为"),e("code",[s._v("ckman.yaml.rpmnew")]),s._v("（"),e("code",[s._v("password")]),s._v("文件同理）。")]),s._v(" "),e("p",[s._v("重新启动"),e("code",[s._v("ckman")]),s._v("：")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("systemctl daemon-reload\nsystemctl start ckman\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("h4",{attrs:{id:"tar-gz升级"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#tar-gz升级"}},[s._v("#")]),s._v(" tar.gz升级")]),s._v(" "),e("p",[s._v("从"),e("code",[s._v("github")]),s._v("上下载最新版的"),e("code",[s._v("ckman")]),e("a",{attrs:{href:"https://github.com/housepower/ckman/releases",target:"_blank",rel:"noopener noreferrer"}},[s._v("安装包"),e("OutboundLink")],1),s._v("。 进入到当前版本"),e("code",[s._v("ckman")]),s._v("的工作目录，停止"),e("code",[s._v("ckman")]),s._v("服务：")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://github.com/housepower/ckman/releases/download/v2.2.5/ckman-v2.2.5-220602.Linux.amd64.tar.gz\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" -xzvf ckman-v2.2.5-220602.Linux.amd64.tar.gz\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#cd ckman && bin/start")]),s._v("\n\nbin/stop\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("p",[s._v("备份配置文件：")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" conf/ckman.yaml conf/ckman.yaml.last\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" conf/password conf/password.last\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("解压最新下载的安装包覆盖掉旧版本的安装目录：")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" -xzvf ckman-x.x.x-YYDDMM.Linux.x86_64.tar.gz -C "),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${WORKDIR}")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("替换配置文件：")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" conf/ckman.yaml.last conf/ckman.yaml\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" conf/password.last conf/password\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("重新启动"),e("code",[s._v("ckman")]),s._v("服务：")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("bin/start\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("需要注意的是，由于"),e("code",[s._v("tar.gz")]),s._v("安装方式可以自行指定工作目录，如果新版本安装位置与旧版本不同，需要将"),e("code",[s._v("conf")]),s._v("目录下的"),e("code",[s._v("clusters.json")]),s._v("拷贝到新版本的工作目录下，否则无法加载集群信息。")]),s._v(" "),e("h3",{attrs:{id:"卸载重装"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#卸载重装"}},[s._v("#")]),s._v(" 卸载重装")]),s._v(" "),e("p",[s._v("卸载之前用yaml安装的，改用源码目前最新版本安装方式；")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("yum remove -y ckman\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#wget https://github.com/housepower/ckman/releases/download/v2.2.5/ckman-v2.2.5-220602.Linux.amd64.tar.gz")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" -xzvf ckman-v2.2.5-220602.Linux.amd64.tar.gz\n\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" conf/ckman.yaml.last conf/ckman.yaml\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" conf/password.last conf/password\n\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" ckman "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v(" bin/start\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br")])]),e("h2",{attrs:{id:"功能介绍"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#功能介绍"}},[s._v("#")]),s._v(" 功能介绍")]),s._v(" "),e("h3",{attrs:{id:"管理创建集群"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#管理创建集群"}},[s._v("#")]),s._v(" 管理创建集群")]),s._v(" "),e("p",[s._v("根据界面提示很容易创建集群，大致步骤如下：")]),s._v(" "),e("ul",[e("li",[s._v("1）上传clickhouse安装rpm包")]),s._v(" "),e("li",[s._v("2）配置监控地址和zookeeper地址")]),s._v(" "),e("li",[s._v("3）设置clickhouse实例数据目录")]),s._v(" "),e("li",[s._v("4）配置clickhouse实例主机")]),s._v(" "),e("li",[s._v("5）创建用户")]),s._v(" "),e("li",[s._v("6）创建集群")])]),s._v(" "),e("p",[e("strong",[e("code",[s._v("ckman")]),s._v("部署的"),e("code",[s._v("clickhouse")]),s._v("集群默认监听了"),e("code",[s._v("9363")]),s._v("端口上报"),e("code",[s._v("metric")]),s._v("给"),e("code",[s._v("prometheus")]),s._v("，因此无需做任何配置。")])]),s._v(" "),e("p",[s._v("如果集群是导入的，请确保"),e("code",[s._v("/etc/clickhouse-server/config.xml")]),s._v("中有以下配置内容：")]),s._v(" "),e("div",{staticClass:"language-xml line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-xml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("\x3c!-- Serve endpoint for Prometheus monitoring. --\x3e")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v('\x3c!--\n        endpoint - mertics path (relative to root, statring with "/")\n        port - port to setup server. If not defined or 0 than http_port used\n        metrics - send data from table system.metrics\n        events - send data from table system.events\n        asynchronous_metrics - send data from table system.asynchronous_metrics\n        status_info - send data from different component from CH, ex: Dictionaries status\n    --\x3e')]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("prometheus")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("endpoint")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("/metrics"),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("endpoint")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("port")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("9363"),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("port")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n\n        "),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("metrics")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("true"),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("metrics")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("events")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("true"),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("events")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("asynchronous_metrics")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("true"),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("asynchronous_metrics")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("status_info")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("true"),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("status_info")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("prometheus")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br")])]),e("h4",{attrs:{id:"安装包管理"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装包管理"}},[s._v("#")]),s._v(" 安装包管理")]),s._v(" "),e("p",[s._v("在主页上点击设置按钮，进入如下的页面：")]),s._v(" "),e("p",[e("img",{attrs:{src:t(569),alt:"img"}})]),s._v(" "),e("p",[s._v("点击Upload RPMs，出现如下界面。")]),s._v(" "),e("p",[e("img",{attrs:{src:t(570),alt:"img"}})]),s._v(" "),e("p",[s._v("注意安装包上传时需要三个安装包都上传（"),e("strong",[s._v("server、client、common")]),s._v("），上传成功后，在安装包列表下会显示新上传的记录：")]),s._v(" "),e("p",[e("img",{attrs:{src:t(571),alt:"img"}})]),s._v(" "),e("table",[e("thead",[e("tr",[e("th",[s._v("21.8.3.44")]),s._v(" "),e("th",[s._v("clickhouse-client-21.8.3.44-2.noarch.rpm,clickhouse-common-static-21.8.3.44-2.x86_64.rpm,clickhouse-server-21.8.3.44-2.noarch.rpm")]),s._v(" "),e("th"),s._v(" "),e("th"),s._v(" "),e("th"),s._v(" "),e("th")])]),s._v(" "),e("tbody")]),s._v(" "),e("h4",{attrs:{id:"创建集群【要点】"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#创建集群【要点】"}},[s._v("#")]),s._v(" "),e("strong",[s._v("创建集群")]),s._v("【要点】")]),s._v(" "),e("p",[s._v("点击主页的 Create a ClickHouse Cluster，就会进入创建集群的界面：")]),s._v(" "),e("p",[e("img",{attrs:{src:t(572),alt:"img"}})]),s._v(" "),e("p",[e("img",{attrs:{src:t(573),alt:"image-20220607105315782"}})]),s._v(" "),e("p",[s._v("需要填写的项主要有以下：")]),s._v(" "),e("ul",[e("li",[e("p",[s._v("ClickHouse Version: ck的版本，不需要自己填写，通过下拉列表选择，下拉列表中会列出ckman服务器中所有的安装包版本。")]),s._v(" "),e("p",[s._v("此处版本信息只会列出当前"),e("code",[s._v("ckman")]),s._v("服务下的安装包版本，如果配置了多中心，其他"),e("code",[s._v("ckman")]),s._v("的安装包是无法看见的")])]),s._v(" "),e("li",[e("p",[s._v("Cluster Name： 集群的名字，注意不要和已有的名字重合")])]),s._v(" "),e("li",[e("p",[s._v("ClickHouse TCP Port: clickhouse的TCP端口，默认是9000，当然也可以自己指定;")])]),s._v(" "),e("li",[e("p",[s._v("ClickHouse Node List: clickhouse节点列表，以逗号分隔")])]),s._v(" "),e("li",[e("p",[s._v("Replica： 是否开启副本，默认是关闭")]),s._v(" "),e("p",[s._v("如果开启了副本，默认是1个"),e("code",[s._v("shard")]),s._v("一个副本，所以节点数量一定要是偶数，否则会报错")]),s._v(" "),e("p",[s._v("如果要增加节点的副本数，可通过增加节点完成，创建集群时最多只能指定一个副本")]),s._v(" "),e("p",[s._v("如果没有开启副本，则有几个节点就有几个"),e("code",[s._v("shard")])])]),s._v(" "),e("li",[e("p",[s._v("Zookeeper Node List: zk列表")])]),s._v(" "),e("li",[e("p",[s._v("ZooKeeper Port: zk端口，默认是2181")])]),s._v(" "),e("li",[e("p",[s._v("Data path: ck节点数据存放的路径； 要点路径目录；比如："),e("code",[s._v("/ckdata1/")])])]),s._v(" "),e("li",[e("p",[s._v("Cluster Username: ck的用户名")])]),s._v(" "),e("li",[e("p",[s._v("Cluster Password: ck的密码")])]),s._v(" "),e("li",[e("p",[s._v("SSH Username: ssh登录ck节点的用户名")]),s._v(" "),e("p",[s._v("该用户必须具有"),e("code",[s._v("root")]),s._v("权限或是"),e("code",[s._v("root")]),s._v("本身，否则部署无法成功，一般都是"),e("code",[s._v("root")]),s._v("。")])]),s._v(" "),e("li",[e("p",[s._v("SSH Password: ssh登录ck节点的密码")])])]),s._v(" "),e("p",[s._v("通过此种方式安装部署成功的集群的mode就是deploy，可以对其进行删、改、rebanlance、启停、升级以及节点的增删等操作；【"),e("strong",[s._v("一定要检查各个端口是否正确；")]),s._v("】目前在host116上面，设置的都是6相关端口；")]),s._v(" "),e("p",[e("em",[e("strong",[s._v("需要注意的是：当前版本的ckman仅支持在centos7以上的系统部署ck。")])])]),s._v(" "),e("p",[s._v("检查端口及进程命令：")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("lsof")]),s._v(" -i tcp:9006\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("lsof")]),s._v(" -i tcp:2186\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#zookeeper")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("lsof")]),s._v(" -i tcp:8086\n\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" -ef "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" zookeeper\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("p",[e("img",{attrs:{src:t(574),alt:"image-20220520173259317"}})]),s._v(" "),e("p",[s._v("目前的环境有：")]),s._v(" "),e("ul",[e("li",[s._v("http://host116:9090/targets")]),s._v(" "),e("li",[s._v("http://host116:8808/")])]),s._v(" "),e("h4",{attrs:{id:"导入集群"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#导入集群"}},[s._v("#")]),s._v(" 导入集群")]),s._v(" "),e("p",[s._v("点击主页的 "),e("code",[s._v("Import a ClickHouse Cluster")]),s._v("按钮，会进去导入集群界面。")]),s._v(" "),e("p",[e("img",{attrs:{src:t(575),alt:"image-20210726101544141"}})]),s._v(" "),e("p",[s._v("需要填写的信息如下所示：")]),s._v(" "),e("ul",[e("li",[e("p",[e("code",[s._v("Cluster Name")]),s._v(": 节点名称，该名称必须是确实存在的集群名，且不能与"),e("code",[s._v("ckman")]),s._v("中已有的集群名字重复。")])]),s._v(" "),e("li",[e("p",[e("code",[s._v("ClickHouse Node IP")]),s._v(": "),e("code",[s._v("clickhouse")]),s._v("节点"),e("code",[s._v("ip")]),s._v("列表，以逗号分隔")])]),s._v(" "),e("li",[e("p",[e("code",[s._v("ClickHouse TCP Port")]),s._v(": "),e("code",[s._v("ck")]),s._v("节点"),e("code",[s._v("TCP")]),s._v("端口，默认为"),e("code",[s._v("9000")])])]),s._v(" "),e("li",[e("p",[e("code",[s._v("Zookeeper Node List")]),s._v(": "),e("code",[s._v("zk")]),s._v("节点列表")])]),s._v(" "),e("li",[e("p",[e("code",[s._v("ZooKeeper Port")]),s._v(": "),e("code",[s._v("zk")]),s._v("端口，默认为"),e("code",[s._v("2181")])])]),s._v(" "),e("li",[e("p",[e("code",[s._v("ZK Status Port")]),s._v(": "),e("code",[s._v("zookeeper")]),s._v("指标监控的端口，默认"),e("code",[s._v("8080")])])]),s._v(" "),e("li",[e("p",[e("code",[s._v("Cluster Username")]),s._v(": "),e("code",[s._v("ck")]),s._v("的用户名")])]),s._v(" "),e("li",[e("p",[e("code",[s._v("Cluster Password")]),s._v(": "),e("code",[s._v("ck")]),s._v("的密码，非必输")])])]),s._v(" "),e("p",[s._v("导入集群有个前提是该集群必须确实存在，否则导入会出现问题。")]),s._v(" "),e("p",[s._v("导入的集群的"),e("code",[s._v("mode")]),s._v("为"),e("code",[s._v("import")]),s._v("，这种模式的集群不能进行修改、"),e("code",[s._v("rebalance")]),s._v("、启停、升级以及节点的增删等操作，但是可以删除和查看。")]),s._v(" "),e("h4",{attrs:{id:"升级集群"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#升级集群"}},[s._v("#")]),s._v(" 升级集群")]),s._v(" "),e("p",[s._v("如果上传了新版本的安装包，可以从"),e("code",[s._v("Upgrade Cluster")]),s._v("下拉列表中选择新版本，点击"),e("code",[s._v("Upgrade")]),s._v("即可进行升级。")]),s._v(" "),e("p",[s._v("目前支持全量升级和滚动升级两种策略。并让用户选择是否检查相同版本。")]),s._v(" "),e("p",[s._v("升级界面如下：")]),s._v(" "),e("p",[e("img",{attrs:{src:t(576),alt:"image-20210726135133819"}})]),s._v(" "),e("h4",{attrs:{id:"销毁集群"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#销毁集群"}},[s._v("#")]),s._v(" 销毁集群")]),s._v(" "),e("p",[s._v("集群销毁后，该集群在物理上都不存在了。因为销毁集群动作不止会停止掉当前集群，还会将节点上的"),e("code",[s._v("ClickHouse")]),s._v("卸载，相关目录清空，所以该动作应该慎重操作。")]),s._v(" "),e("h4",{attrs:{id:"增加节点"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#增加节点"}},[s._v("#")]),s._v(" 增加节点")]),s._v(" "),e("p",[s._v("点击"),e("code",[s._v("Manage")]),s._v("页面的"),e("code",[s._v("Add Node")]),s._v("按钮以增加节点。")]),s._v(" "),e("p",[e("img",{attrs:{src:t(577),alt:"image-20210726105430879"}})]),s._v(" "),e("p",[s._v("增加节点需要填写：")]),s._v(" "),e("blockquote",[e("ul",[e("li",[e("code",[s._v("New Node IP")]),s._v(": 新节点的"),e("code",[s._v("IP")]),s._v("，可以一次性增加多个节点，这些节点将会位于同一个"),e("code",[s._v("shard")]),s._v("上。")]),s._v(" "),e("li",[e("code",[s._v("Node Shard")]),s._v(": 节点的"),e("code",[s._v("Shard NUmber")]),s._v("。")]),s._v(" "),e("li",[s._v("如果填写的"),e("code",[s._v("shard")]),s._v("是已经存在的，那么增加的节点会作为已存在"),e("code",[s._v("shard")]),s._v("的一个副本；如果"),e("code",[s._v("shard")]),s._v("不存在（一般是最大的"),e("code",[s._v("shard")]),s._v("编号"),e("code",[s._v("+1")]),s._v("，如果不是就不正确了），就会新增加一个"),e("code",[s._v("shard")]),s._v("。")]),s._v(" "),e("li",[s._v("如果集群不支持副本模式，则每个"),e("code",[s._v("shard")]),s._v("只能有一个节点，不可以给已有"),e("code",[s._v("shard")]),s._v("添加副本节点，如果集群支持副本模式，则可以在任意"),e("code",[s._v("shard")]),s._v("增加节点。")])])]),s._v(" "),e("h4",{attrs:{id:"删除节点"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#删除节点"}},[s._v("#")]),s._v(" 删除节点")]),s._v(" "),e("p",[s._v("删除节点时需要注意的是：删除节点并不会销毁该节点，只会停止该节点的"),e("code",[s._v("clickhouse")]),s._v("服务，并从"),e("code",[s._v("clusters.json")]),s._v("中删除掉。")]),s._v(" "),e("p",[s._v("删除节点时，如果某个"),e("code",[s._v("shard")]),s._v("有且只有一个节点，那么这个节点一般是不可以被删除的，除非该节点处于"),e("code",[s._v("shard")]),s._v("编号的最大位置。")]),s._v(" "),e("h3",{attrs:{id:"监控管理"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#监控管理"}},[s._v("#")]),s._v(" 监控管理")]),s._v(" "),e("p",[e("code",[s._v("ckman")]),s._v("提供了"),e("code",[s._v("ClickHouse")]),s._v("相关的一些指标监控项。这些监控项依赖于从"),e("code",[s._v("prometheus")]),s._v("中获取数据，因此，需要提前配置好"),e("code",[s._v("prometheus")]),s._v("。相关配置教程见"),e("RouterLink",{attrs:{to:"/03.实践部署/02.项目实践/53.wdp数据底座/guide/deploy.html"}},[s._v("ckman部署文档")]),s._v("。")],1),s._v(" "),e("p",[e("img",{attrs:{src:t(578),alt:"image-20210302181407722"}})]),s._v(" "),e("h4",{attrs:{id:"clickhouse-database-kpis"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#clickhouse-database-kpis"}},[s._v("#")]),s._v(" ClickHouse Database KPIs")]),s._v(" "),e("table",[e("thead",[e("tr",[e("th",[s._v("指标")]),s._v(" "),e("th",[s._v("说明")])])]),s._v(" "),e("tbody",[e("tr",[e("td",[e("code",[s._v("clickhouse.Query")])]),s._v(" "),e("td",[s._v("针对"),e("code",[s._v("Clickhouse")]),s._v("集群的分布式表发起的查询，按照发起时刻的分布图")])])])]),s._v(" "),e("h4",{attrs:{id:"clickhouse-node-kpis"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#clickhouse-node-kpis"}},[s._v("#")]),s._v(" ClickHouse Node KPIs")]),s._v(" "),e("table",[e("thead",[e("tr",[e("th",[s._v("指标")]),s._v(" "),e("th",[s._v("说明")])])]),s._v(" "),e("tbody",[e("tr",[e("td",[e("code",[s._v("cpu usage")])]),s._v(" "),e("td",[e("code",[s._v("CPU")]),s._v("占用情况")])]),s._v(" "),e("tr",[e("td",[e("code",[s._v("memory usage")])]),s._v(" "),e("td",[s._v("内存占用情况")])]),s._v(" "),e("tr",[e("td",[e("code",[s._v("disk usage")])]),s._v(" "),e("td",[s._v("硬盘占用情况")])]),s._v(" "),e("tr",[e("td",[e("code",[s._v("IOPS")])]),s._v(" "),e("td",[e("code",[s._v("IO")]),s._v("指标")])])])]),s._v(" "),e("h4",{attrs:{id:"zookeeper-kpis"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#zookeeper-kpis"}},[s._v("#")]),s._v(" ZooKeeper KPIs")]),s._v(" "),e("table",[e("thead",[e("tr",[e("th",[s._v("指标")]),s._v(" "),e("th",[s._v("说明")])])]),s._v(" "),e("tbody",[e("tr",[e("td",[e("code",[s._v("znode_count")])]),s._v(" "),e("td",[e("code",[s._v("znode")]),s._v("数")])]),s._v(" "),e("tr",[e("td",[e("code",[s._v("leader_uptime")])]),s._v(" "),e("td",[e("code",[s._v("leader")]),s._v("存活时间")])]),s._v(" "),e("tr",[e("td",[e("code",[s._v("stale_sessions_expired")])]),s._v(" "),e("td",[s._v("过期的会话")])]),s._v(" "),e("tr",[e("td",[e("code",[s._v("jvm_gc_collection_seconds_count")])]),s._v(" "),e("td",[e("code",[s._v("jvm")]),s._v(" "),e("code",[s._v("gc")]),s._v("的次数")])]),s._v(" "),e("tr",[e("td",[e("code",[s._v("jvm_gc_collection_seconds_sum")])]),s._v(" "),e("td",[e("code",[s._v("jvm")]),s._v(" "),e("code",[s._v("gc")]),s._v("花费的时间")])])])]),s._v(" "),e("h3",{attrs:{id:"表-会话管理"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#表-会话管理"}},[s._v("#")]),s._v(" 表&会话管理")]),s._v(" "),e("h4",{attrs:{id:"table-metrics"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#table-metrics"}},[s._v("#")]),s._v(" Table Metrics")]),s._v(" "),e("p",[s._v("统计表的一些指标。除"),e("code",[s._v("system")]),s._v("数据库的表之外，其他数据库的表都会显示在下面。")]),s._v(" "),e("p",[s._v("指标包括：")]),s._v(" "),e("ul",[e("li",[e("p",[e("code",[s._v("Table Name")]),s._v(" 表名")])]),s._v(" "),e("li",[e("p",[e("code",[s._v("Columns")]),s._v(" 列数")])]),s._v(" "),e("li",[e("p",[e("code",[s._v("Rows")]),s._v(" 行数")])]),s._v(" "),e("li",[e("p",[e("code",[s._v("Partitions")]),s._v(" 当前所有未合并的分区数")])]),s._v(" "),e("li",[e("p",[e("code",[s._v("Parts Count")]),s._v(" 分区数")])]),s._v(" "),e("li",[e("p",[e("code",[s._v("Disk Space(uncompress)")]),s._v(" 使用磁盘（未压缩）")])]),s._v(" "),e("li",[e("p",[e("code",[s._v("Disk Space(compress)")]),s._v(" 使用磁盘（压缩），该大小是最终数据落盘的占用空间")])]),s._v(" "),e("li",[e("p",[e("code",[s._v("RWStatus")]),s._v(" 读写状态， "),e("code",[s._v("TRUE")]),s._v("代表可读写，"),e("code",[s._v("FALSE")]),s._v("代表不可读写")])]),s._v(" "),e("li",[e("p",[e("code",[s._v("Completed Queries in last 24h")]),s._v(" 过去"),e("code",[s._v("24")]),s._v("小时成功的"),e("code",[s._v("SQL")]),s._v("条数")])]),s._v(" "),e("li",[e("p",[e("code",[s._v("Failed Queries in last 24h")]),s._v(" 过去"),e("code",[s._v("24")]),s._v("小时失败的"),e("code",[s._v("SQL")]),s._v("条数")])]),s._v(" "),e("li",[e("p",[e("code",[s._v("Queries cost(0.5, 0.99, max) in last 7days(ms)")]),s._v("过去"),e("code",[s._v("7")]),s._v("天"),e("code",[s._v("SQL")]),s._v("花费的时间。")]),s._v(" "),e("p",[e("code",[s._v("Queries Cost")]),s._v("有三个值：")]),s._v(" "),e("ul",[e("li",[e("code",[s._v("0.5")]),s._v("：过去"),e("code",[s._v("7")]),s._v("天"),e("code",[s._v("50% SQL")]),s._v("的平均耗时")]),s._v(" "),e("li",[e("code",[s._v("0.99")]),s._v("：过去"),e("code",[s._v("7")]),s._v("天"),e("code",[s._v("99% SQL")]),s._v("的平均耗时")]),s._v(" "),e("li",[e("code",[s._v("max")]),s._v("：过去"),e("code",[s._v("7")]),s._v("天 "),e("code",[s._v("SQL")]),s._v("最大耗时")])])])]),s._v(" "),e("p",[e("img",{attrs:{src:t(579),alt:"image-20210726134249068"}})]),s._v(" "),e("h4",{attrs:{id:"table-replication-status"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#table-replication-status"}},[s._v("#")]),s._v(" Table Replication Status")]),s._v(" "),e("p",[s._v("统计复制表的一些状态。")]),s._v(" "),e("p",[e("img",{attrs:{src:t(580),alt:"image-20210302133411795"}})]),s._v(" "),e("p",[s._v("此处会统计每个"),e("code",[s._v("shard")]),s._v("下每张表的各副本之间的统计量。")]),s._v(" "),e("p",[s._v("理论上每个"),e("code",[s._v("shard")]),s._v("内副本之间各表的统计都应该相等的，如果有不相等，就说明有节点落后了，这时候落后的节点会标黄。如果某个副本上所有的表都落后，说明这个副本可能出问题了。")]),s._v(" "),e("h4",{attrs:{id:"zookeeper-status"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#zookeeper-status"}},[s._v("#")]),s._v(" Zookeeper Status")]),s._v(" "),e("p",[e("code",[s._v("zookeeper")]),s._v("的相关指标查看。"),e("code",[s._v("zookeeper")]),s._v("监控使用的是"),e("code",[s._v("zookeeper-3.5.0")]),s._v("版本新增的特性，通过暴露的"),e("code",[s._v("8080")]),s._v("端口监控"),e("code",[s._v("mntr")]),s._v("指标信息，因此，如果想要看到"),e("code",[s._v("zookeeper")]),s._v("的监控指标，需要保证当前使用的"),e("code",[s._v("zookeeper")]),s._v("版本大于等于"),e("code",[s._v("3.5.0")]),s._v("。")]),s._v(" "),e("p",[s._v("可查看的指标包括：版本，主从状态，平均延迟，近似数据总和大小，"),e("code",[s._v("znode")]),s._v("数等。")]),s._v(" "),e("p",[e("img",{attrs:{src:t(581),alt:"image-20210726141459318"}})]),s._v(" "),e("h4",{attrs:{id:"open-sessions"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#open-sessions"}},[s._v("#")]),s._v(" Open Sessions")]),s._v(" "),e("p",[s._v("显示当前正在进行的会话。")]),s._v(" "),e("p",[e("img",{attrs:{src:t(582),alt:"image-20210301151056577"}})]),s._v(" "),e("h4",{attrs:{id:"slow-sessions"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#slow-sessions"}},[s._v("#")]),s._v(" Slow Sessions")]),s._v(" "),e("p",[s._v("显示"),e("code",[s._v("7")]),s._v("天内最慢的"),e("code",[s._v("10")]),s._v("条"),e("code",[s._v("SQL")]),s._v("语句。")]),s._v(" "),e("p",[s._v("包含"),e("code",[s._v("SQL")]),s._v("的执行时间、"),e("code",[s._v("SQL")]),s._v("耗时、"),e("code",[s._v("SQL")]),s._v("语句、"),e("code",[s._v("ck")]),s._v("用户、"),e("code",[s._v("query id")]),s._v("、查询的"),e("code",[s._v("IP")]),s._v("以及线程号。")]),s._v(" "),e("p",[e("img",{attrs:{src:t(583),alt:"image-20210726112101073"}})]),s._v(" "),e("h3",{attrs:{id:"query查询管理"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#query查询管理"}},[s._v("#")]),s._v(" Query查询管理")]),s._v(" "),e("p",[e("code",[s._v("ckman")]),s._v("还提供了简单的"),e("code",[s._v("clickhouse")]),s._v("查询的页面。通过该页面可以查询集群中的数据。")]),s._v(" "),e("p",[e("img",{attrs:{src:t(584),alt:"image-20210301151624044"}})]),s._v(" "),e("blockquote",[e("p",[s._v("注意：")]),s._v(" "),e("p",[s._v("该工具只能查询，不能进行"),e("code",[s._v("mutation")]),s._v("的相关操作。")]),s._v(" "),e("p",[s._v("该工具主要针对分布式表，本地表也能查，但是如果本地表在集群的其他节点不存在，就会报错。即使表在所有节点都存在，查询出来的数据也是某个节点的数据，因此每次查询出来的数据可能不一致。")])]),s._v(" "),e("h3",{attrs:{id:"配置管理"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#配置管理"}},[s._v("#")]),s._v(" 配置管理")]),s._v(" "),e("p",[s._v("通过集群配置管理页面，可以修改集群的配置，注意对存储策略的配置的修改，如果已有的存储介质上已有数据，则该存储介质不可删除。")]),s._v(" "),e("p",[e("code",[s._v("ckman")]),s._v("会根据修改的集群配置的具体内容来决定集群是否需要重启。")]),s._v(" "),e("h2",{attrs:{id:"配置磁盘策略"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#配置磁盘策略"}},[s._v("#")]),s._v(" 配置磁盘策略")]),s._v(" "),e("p",[s._v("参考：https://cloud.tencent.com/developer/article/1649377")]),s._v(" "),e("p",[s._v("Clickhouse对多硬盘的配置是通过Policy实现的，架构图如下：")]),s._v(" "),e("p",[e("img",{attrs:{src:t(585),alt:"img"}})]),s._v(" "),e("p",[s._v("可以看到，对于具体某个表，选择不同的Policy，会决定最终的数据的存储方式。对于数据的存储，到具体的磁盘位置，是需要经过Policy,Volume两层的逻辑关系")]),s._v(" "),e("p",[s._v("Policy可以对接两个Volume,Volume可以对接多个磁盘。简单来说，两个Volume可以实现数据的冷热存储，一个Volume对接多个磁盘，实现数据的分散存储，充分利用多个磁盘的并行处理能力。注意Volume是在Policy里面定义的，所以一个Volume只能对应一个policy")]),s._v(" "),e("p",[s._v("默认的策列defalut，所有表的元数据，是存储在集群创建时候选择的存储路径中，建议这里使用SSD高速磁盘")]),s._v(" "),e("p",[e("img",{attrs:{src:t(586),alt:"img"}})]),s._v(" "),e("p",[s._v("策列和存储卷可以在这里进行配置：")]),s._v(" "),e("p",[e("img",{attrs:{src:t(587),alt:"img"}})]),s._v(" "),e("p",[s._v("定义磁盘：")]),s._v(" "),e("p",[e("img",{attrs:{src:t(588),alt:"img"}})]),s._v(" "),e("p",[s._v("定义policy:")]),s._v(" "),e("p",[e("img",{attrs:{src:t(589),alt:"img"}})]),s._v(" "),e("div",{staticClass:"language-xml line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-xml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("sdc_sdd_jbod")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" > "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("\x3c!-- name for new storage policy --\x3e")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("volumes")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("sdc_sdd_jbod_volume")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("\x3c!-- name of volume --\x3e")]),s._v("\n      "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("\x3c!--\n      the order of listing disks inside\n      volume defines round-robin sequence\n      --\x3e")]),s._v("\n      "),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("disk")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("sdc"),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("disk")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n      "),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("disk")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("sdd"),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("disk")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("sdc_sdd_jbod_volume")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("volumes")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token tag"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("sdc_sdd_jbod")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br")])]),e("p",[s._v("实现冷热数据的处理，比如热数据在SSD，冷的数据在普通磁盘")]),s._v(" "),e("p",[s._v("有个重要的参数： max_data_part_size，这个在ckman里面也是可以配置的")]),s._v(" "),e("p",[s._v("注意卷的先后循序很重要，数据是先放在第一个卷里面的")]),s._v(" "),e("p",[s._v("当数据超过阈值，被合并后，合并的结果就会放到第二个卷里面，也就是冷卷")]),s._v(" "),e("p",[s._v("用法：")]),s._v(" "),e("p",[s._v("建表的时候设置 storage_policy")]),s._v(" "),e("div",{staticClass:"language-sql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLE")]),s._v(" sample3 "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("id UInt64"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Engine")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("MergeTree "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ORDER")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" id SETTINGS storage_policy "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sdc_sdd_jbod'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h2",{attrs:{id:"如何进行监控"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#如何进行监控"}},[s._v("#")]),s._v(" 如何进行监控")]),s._v(" "),e("h3",{attrs:{id:"运维操作语句"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#运维操作语句"}},[s._v("#")]),s._v(" 运维操作语句")]),s._v(" "),e("p",[s._v("查看磁盘空间：")]),s._v(" "),e("div",{staticClass:"language-sql line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sql"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v("\n    name"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    path"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    formatReadableSize"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("free_space"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AS")]),s._v(" free"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    formatReadableSize"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("total_space"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AS")]),s._v(" total"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    formatReadableSize"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("keep_free_space"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AS")]),s._v(" reserved\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" system"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("disks\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br")])]),e("h2",{attrs:{id:"配置文件说明"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#配置文件说明"}},[s._v("#")]),s._v(" 配置文件说明")]),s._v(" "),e("h3",{attrs:{id:"server"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#server"}},[s._v("#")]),s._v(" server")]),s._v(" "),e("ul",[e("li",[e("code",[s._v("id")]),s._v(" "),e("ul",[e("li",[e("code",[s._v("ckman")]),s._v("集群"),e("code",[s._v("id")]),s._v("，同一个集群的"),e("code",[s._v("ckman")]),s._v("的"),e("code",[s._v("id")]),s._v("号配置必须不同")])])]),s._v(" "),e("li",[e("code",[s._v("port")]),s._v(" "),e("ul",[e("li",[e("code",[s._v("ckman")]),s._v("的监听端口")]),s._v(" "),e("li",[s._v("默认为"),e("code",[s._v("8808")])])])]),s._v(" "),e("li",[e("code",[s._v("https")]),s._v(" "),e("ul",[e("li",[s._v("是否监听"),e("code",[s._v("https")])]),s._v(" "),e("li",[s._v("默认为"),e("code",[s._v("false")])])])]),s._v(" "),e("li",[e("code",[s._v("certfile")]),s._v(" "),e("ul",[e("li",[e("code",[s._v("https")]),s._v("的证书文件，如果开启了"),e("code",[s._v("https")])]),s._v(" "),e("li",[s._v("默认使用"),e("code",[s._v("conf")]),s._v("下的"),e("code",[s._v("server.crt")])])])]),s._v(" "),e("li",[e("code",[s._v("keyfile")]),s._v(" "),e("ul",[e("li",[e("code",[s._v("https")]),s._v("的"),e("code",[s._v("key")]),s._v("文件，如果开启了"),e("code",[s._v("https")])]),s._v(" "),e("li",[s._v("默认使用"),e("code",[s._v("conf")]),s._v("下的"),e("code",[s._v("server.key")])])])]),s._v(" "),e("li",[e("code",[s._v("pprof")]),s._v(" "),e("ul",[e("li",[s._v("是否支持"),e("code",[s._v("pprof")]),s._v("监控")]),s._v(" "),e("li",[s._v("默认为"),e("code",[s._v("true")])])])]),s._v(" "),e("li",[e("code",[s._v("session_timeout")]),s._v(" "),e("ul",[e("li",[s._v("会话超时时间，如果超过该时间没有对"),e("code",[s._v("ckman")]),s._v("进行任何操作，则"),e("code",[s._v("token")]),s._v("失效，需要重新登录")]),s._v(" "),e("li",[s._v("默认超时时间为"),e("code",[s._v("3600")]),s._v("秒")])])]),s._v(" "),e("li",[e("code",[s._v("public_key")]),s._v(" "),e("ul",[e("li",[s._v("用来接入"),e("code",[s._v("ckman")]),s._v("的公钥")]),s._v(" "),e("li",[e("code",[s._v("ckman")]),s._v("可通过"),e("code",[s._v("RSA")]),s._v("配置公钥的方式跳过"),e("code",[s._v("token")]),s._v("鉴权，只需要在客户端对"),e("code",[s._v("header")]),s._v("配置"),e("code",[s._v("userToken")]),s._v("，并对"),e("code",[s._v("userToken")]),s._v("使用私钥加密，然后在"),e("code",[s._v("ckman")]),s._v("服务端使用该公钥进行解密即可。")])])]),s._v(" "),e("li",[e("code",[s._v("swagger_enable")]),s._v(" "),e("ul",[e("li",[s._v("是否开启"),e("code",[s._v("swagger")]),s._v("文档")]),s._v(" "),e("li",[s._v("默认不开启")])])]),s._v(" "),e("li",[e("code",[s._v("task_interval")]),s._v(" "),e("ul",[e("li",[s._v("执行异步运维动作的扫描时间间隔")]),s._v(" "),e("li",[s._v("前端请求部署、升级、销毁以及增删节点等比较耗时的操作时，"),e("code",[s._v("ckman")]),s._v("先记录状态，然后使用另外的协程异步扫描处理，异步扫描的时间间隔通过该参数可配，默认为"),e("code",[s._v("5")]),s._v("秒")])])]),s._v(" "),e("li",[e("code",[s._v("persistant_policy")]),s._v(" "),e("ul",[e("li",[s._v("持久化策略，主要用来存储集群的配置信息，包括集群配置、逻辑集群映射关系 、查询语句历史记录、运维操作状态等。")]),s._v(" "),e("li",[s._v("持久化策略支持"),e("code",[s._v("local")]),s._v("、"),e("code",[s._v("mysql")]),s._v("和"),e("code",[s._v("postgres")]),s._v(" "),e("ul",[e("li",[e("code",[s._v("local")]),s._v("：存储到本地，在"),e("code",[s._v("conf")]),s._v("目录下生成一个"),e("code",[s._v("clusters.json")]),s._v("文件，不支持集群，为默认配置")]),s._v(" "),e("li",[e("code",[s._v("mysql")]),s._v("：持久化到"),e("code",[s._v("mysql")]),s._v("，支持"),e("code",[s._v("ckman")]),s._v("集群，支持"),e("code",[s._v("HA")]),s._v("，需要提前创建数据库，数据库编码为"),e("code",[s._v("UTF-8")]),s._v("，不需要创建表，"),e("code",[s._v("ckman")]),s._v("会自动创建数据库表")]),s._v(" "),e("li",[e("code",[s._v("postgres")]),s._v("：持久化到"),e("code",[s._v("postgres")]),s._v("，支持"),e("code",[s._v("ckman")]),s._v("集群，支持"),e("code",[s._v("HA")]),s._v("，需要提前创建数据库，并且需要提前创建数据库表。建表语句内置在"),e("code",[s._v("dbscript/postgres.sql")]),s._v("中。")]),s._v(" "),e("li",[s._v("除"),e("code",[s._v("local")]),s._v("策略外，其他持久化策略都依赖"),e("code",[s._v("persistent_config")]),s._v("中的配置项，当然"),e("code",[s._v("local")]),s._v("也可以配置该项。")])])])])])]),s._v(" "),e("p",[s._v("示例如下：")]),s._v(" "),e("div",{staticClass:"language-yaml line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("server")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("id")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("8808")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("https")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("false")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#certfile:")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#keyfile:")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("pprof")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("swagger_enable")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("session_timeout")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3600")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# support local, mysql, postgres")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("persistent_policy")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" local\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("task_interval")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#public_key:")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br")])]),e("h3",{attrs:{id:"log"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#log"}},[s._v("#")]),s._v(" log")]),s._v(" "),e("ul",[e("li",[e("code",[s._v("level")]),s._v(" "),e("ul",[e("li",[s._v("日志打印级别")]),s._v(" "),e("li",[s._v("默认为"),e("code",[s._v("INFO")])]),s._v(" "),e("li",[s._v("支持 "),e("code",[s._v("DEBUG")]),s._v("、"),e("code",[s._v("INFO")]),s._v("、"),e("code",[s._v("WARN")]),s._v("、"),e("code",[s._v("ERROR")]),s._v("、"),e("code",[s._v("PANIC")]),s._v("、"),e("code",[s._v("FATAL")])])])]),s._v(" "),e("li",[e("code",[s._v("max_count")]),s._v(" "),e("ul",[e("li",[s._v("滚动日志数量")]),s._v(" "),e("li",[s._v("默认为"),e("code",[s._v("5")]),s._v("个")])])]),s._v(" "),e("li",[e("code",[s._v("max_age")]),s._v(" "),e("ul",[e("li",[s._v("日志生命有效期")]),s._v(" "),e("li",[s._v("默认为"),e("code",[s._v("10")]),s._v("天")])])])]),s._v(" "),e("p",[s._v("示例如下：")]),s._v(" "),e("div",{staticClass:"language-yaml line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("log")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("level")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" INFO\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("max_count")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# megabyte")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("max_size")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# day")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("max_age")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br")])]),e("h3",{attrs:{id:"persistent-config"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#persistent-config"}},[s._v("#")]),s._v(" persistent_config")]),s._v(" "),e("h4",{attrs:{id:"mysql-postgres"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#mysql-postgres"}},[s._v("#")]),s._v(" mysql & postgres")]),s._v(" "),e("p",[e("code",[s._v("mysql")]),s._v("和"),e("code",[s._v("postgres")]),s._v("配置项基本一致，主要涉及以下配置项：")]),s._v(" "),e("ul",[e("li",[e("p",[e("code",[s._v("host")])]),s._v(" "),e("ul",[e("li",[s._v("连接数据库的ip地址")])])]),s._v(" "),e("li",[e("p",[e("code",[s._v("port")])]),s._v(" "),e("ul",[e("li",[s._v("连接数据库的端口号，如"),e("code",[s._v("mysql")]),s._v("默认为"),e("code",[s._v("3306")]),s._v("，"),e("code",[s._v("postgres")]),s._v("默认为"),e("code",[s._v("5432")])])])]),s._v(" "),e("li",[e("p",[e("code",[s._v("user")])]),s._v(" "),e("ul",[e("li",[s._v("连接数据库的用户")])])]),s._v(" "),e("li",[e("p",[e("code",[s._v("password")])]),s._v(" "),e("ul",[e("li",[s._v("连接数据库的密码，需要加密，可使用下面命令获得密码的密文")])]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("ckman --encrypt "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("123456")]),s._v(" \nE310E892E56801CED9ED98AA177F18E6\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])])]),s._v(" "),e("li",[e("p",[e("code",[s._v("database")])]),s._v(" "),e("ul",[e("li",[s._v("需要连接的数据库，需提前创建，并且保证编码为"),e("code",[s._v("UTF-8")])])])])]),s._v(" "),e("h4",{attrs:{id:"local"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#local"}},[s._v("#")]),s._v(" local")]),s._v(" "),e("ul",[e("li",[e("code",[s._v("format")]),s._v(" "),e("ul",[e("li",[s._v("本地文件格式，支持"),e("code",[s._v("JSON")]),s._v("和"),e("code",[s._v("yaml")]),s._v("，默认为"),e("code",[s._v("json")])])])]),s._v(" "),e("li",[e("code",[s._v("config_dir")]),s._v(" "),e("ul",[e("li",[s._v("本地文件的目录，需要填写路径，默认为"),e("code",[s._v("ckman")]),s._v("工作路径的"),e("code",[s._v("conf")]),s._v("目录下")])])]),s._v(" "),e("li",[e("code",[s._v("config_file")]),s._v(" "),e("ul",[e("li",[s._v("本地文件的文件名，默认为"),e("code",[s._v("clusters")])])])])]),s._v(" "),e("h3",{attrs:{id:"nacos"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#nacos"}},[s._v("#")]),s._v(" nacos")]),s._v(" "),e("ul",[e("li",[e("code",[s._v("enabled")]),s._v(" "),e("ul",[e("li",[s._v("是否开启"),e("code",[s._v("nacos")])]),s._v(" "),e("li",[s._v("默认为不开启")])])]),s._v(" "),e("li",[e("code",[s._v("hosts")]),s._v(" "),e("ul",[e("li",[e("code",[s._v("nacos")]),s._v("服务的"),e("code",[s._v("ip")]),s._v("地址")]),s._v(" "),e("li",[s._v("可以配置多组")])])]),s._v(" "),e("li",[e("code",[s._v("port")]),s._v(" "),e("ul",[e("li",[e("code",[s._v("nacos")]),s._v("服务的端口")])])]),s._v(" "),e("li",[e("code",[s._v("user_name")]),s._v(" "),e("ul",[e("li",[s._v("登录"),e("code",[s._v("nacos")]),s._v("的用户名")])])]),s._v(" "),e("li",[e("code",[s._v("password")]),s._v(" "),e("ul",[e("li",[s._v("登录"),e("code",[s._v("nacos")]),s._v("的密码，需要加密，加密规则同持久化策略数据库密码加密规则")])])]),s._v(" "),e("li",[e("code",[s._v("namespace")]),s._v(" "),e("ul",[e("li",[s._v("指定"),e("code",[s._v("nacos")]),s._v("的"),e("code",[s._v("namespace")]),s._v("，默认为"),e("code",[s._v("DEFAULT")])])])]),s._v(" "),e("li",[e("code",[s._v("group")]),s._v(" "),e("ul",[e("li",[s._v("向"),e("code",[s._v("nacos")]),s._v("注册的服务所在的组")]),s._v(" "),e("li",[s._v("默认为"),e("code",[s._v("DEFAULT_GROUP")])])])]),s._v(" "),e("li",[e("code",[s._v("data_id")]),s._v(" "),e("ul",[e("li",[s._v("向"),e("code",[s._v("nacos")]),s._v("注册服务名称、数据项名称")]),s._v(" "),e("li",[s._v("默认为"),e("code",[s._v("ckman")])])])])]),s._v(" "),e("p",[s._v("示例如下：")]),s._v(" "),e("div",{staticClass:"language-yaml line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("nacos")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("enabled")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("false")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" 127.0.0.1\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("8848")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("user_name")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nacos\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("password")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 0192023A7BBD73250516F069DF18B500\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#namespace:")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#group:")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#data_id:")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br")])]),e("h2",{attrs:{id:"参考文档"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#参考文档"}},[s._v("#")]),s._v(" 参考文档")]),s._v(" "),e("ul",[e("li",[s._v("https://github.com/housepower/ckman/blob/main/docs/ckman_v2.0.0.md")]),s._v(" "),e("li",[s._v("https://github.com/housepower/ckman/blob/main/docs/guide/deploy.md")]),s._v(" "),e("li",[s._v("官方教学视频 "),e("a",{attrs:{href:"https://www.bilibili.com/video/BV1gR4y1t75Q/",target:"_blank",rel:"noopener noreferrer"}},[s._v("clickhouse可视化管理工具ckman使用教程_哔哩哔哩_bilibili"),e("OutboundLink")],1)])])])}),[],!1,null,null,null);a.default=n.exports}}]);