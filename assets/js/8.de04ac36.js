(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{431:function(s,a,t){s.exports=t.p+"assets/img/image-20220303171158659.393017a9.png"},432:function(s,a,t){s.exports=t.p+"assets/img/image-20220221171615107.2515d8e9.png"},433:function(s,a,t){s.exports=t.p+"assets/img/image-20220325112135047.5beb6a74.png"},434:function(s,a,t){s.exports=t.p+"assets/img/image-20220301161751596.622340de.png"},435:function(s,a,t){s.exports=t.p+"assets/img/image-20220301161957106.81fb919b.png"},436:function(s,a,t){s.exports=t.p+"assets/img/image-20220301162051431.e0c9ab4f.png"},437:function(s,a,t){s.exports=t.p+"assets/img/image-20220301162452091.0925d03c.png"},438:function(s,a,t){s.exports=t.p+"assets/img/image-20220301162647613.c0a20d6d.png"},439:function(s,a,t){s.exports=t.p+"assets/img/image-20220309162521826.a9ccdcd1.png"},440:function(s,a,t){s.exports=t.p+"assets/img/image-20220301165626453.a48ba2e7.png"},441:function(s,a,t){s.exports=t.p+"assets/img/image-20220301163134527.c1d2e52c.png"},442:function(s,a,t){s.exports=t.p+"assets/img/image-20220301165532548.05a13c91.png"},443:function(s,a,t){s.exports=t.p+"assets/img/image-20220310094528334.01a50681.png"},444:function(s,a,t){s.exports=t.p+"assets/img/image-20220328142605788.c207c2d8.png"},750:function(s,a,t){"use strict";t.r(a);var n=t(31),r=Object(n.a)({},(function(){var s=this,a=s.$createElement,n=s._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h2",{attrs:{id:"背景"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#背景"}},[s._v("#")]),s._v(" 背景")]),s._v(" "),n("p",[s._v("得快速部署现有巡检系统，交付客户使用；")]),s._v(" "),n("h2",{attrs:{id:"基本环境"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#基本环境"}},[s._v("#")]),s._v(" 基本环境")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[s._v("yum -y "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("unzip")]),s._v("\nyum -y "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v("\nyum -y "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" gcc gcc-c++ autoconf "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v("\nyum -y "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" openssl-devel\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[s._v("httpd服务")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[s._v("yum "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" yum-utils createrepo httpd\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("which")]),s._v(" httpd\nsystemctl httpd\nsystemctl start httpd\nsystemctl "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" httpd \n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" /etc/httpd/conf/httpd.conf \nsystemctl restart httpd\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查找软件")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("which")]),s._v(" httpd\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("find")]),s._v(" / -name httpd\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("p",[s._v("时间同步")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("which")]),s._v(" ntp\nyum -y "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" ntp\nsystemctl restart ntpd\nsystemctl "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" ntpd\nsystemctl stop ntpd\nsystemctl start ntpd\n\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" /etc/ntp.conf \n \nntpstat\nntpq -p\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("date")]),s._v("\nntpdate vhost-118-21\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br")])]),n("h2",{attrs:{id:"干净离线虚拟环境部署"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#干净离线虚拟环境部署"}},[s._v("#")]),s._v(" 干净离线虚拟环境部署")]),s._v(" "),n("h3",{attrs:{id:"nginx-redis-mysql安装"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nginx-redis-mysql安装"}},[s._v("#")]),s._v(" nginx/redis/mysql安装")]),s._v(" "),n("h4",{attrs:{id:"nginx"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nginx"}},[s._v("#")]),s._v(" nginx")]),s._v(" "),n("p",[s._v("源码安装")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# install nginx")]),s._v("\nRUN "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$WORKDIR")]),s._v("/soft/nginx "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" -zxvf  nginx-1.18.0.tar.gz "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" nginx-1.18.0 "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" ./configure --prefix"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/nginx "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --pid-path"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/var/run/nginx/nginx.pid "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --lock-path"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/var/lock/nginx.lock "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --error-log-path"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/var/log/nginx/error.log "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --http-log-path"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/var/log/nginx/access.log "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" install"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ln")]),s._v(" -s /usr/local/nginx/sbin/nginx /usr/sbin/nginx "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" -rf "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("/*.gz "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" -rf "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$WORKDIR")]),s._v("/soft/nginx/nginx.conf /usr/local/nginx/conf/\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br")])]),n("p",[n("code",[s._v("/usr/local/nginx/conf/nginx.conf")])]),s._v(" "),n("div",{staticClass:"language-nginx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-nginx"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#user  nobody;")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("worker_processes")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#error_log  logs/error.log;")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#error_log  logs/error.log  notice;")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#error_log  logs/error.log  info;")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("error_log")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("var"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("log"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("error"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("log warn"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#pid        logs/nginx.pid;")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("pid")]),s._v("        "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("var"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("run"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("pid")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("events")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("worker_connections")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("http")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("include")]),s._v("       mime"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("types")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default_type")]),s._v("  application"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("octet"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("stream"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("log_format")]),s._v("  main  "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'$remote_addr - $remote_user [$time_local] \"$request\" '")]),s._v("\n                      "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'$status $body_bytes_sent \"$http_referer\" '")]),s._v("\n                      "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'"$http_user_agent" "$http_x_forwarded_for"\'')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#access_log  logs/access.log  main;")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("access_log")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("var"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("log"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("access"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("log  main"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("sendfile")]),s._v("        on"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#tcp_nopush     on;")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#keepalive_timeout  0;")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("keepalive_timeout")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("65")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  \n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("client_max_body_size")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("500")]),s._v("m"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#gzip  on;")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("include")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("usr"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("local"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("conf"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("conf"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("d"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("conf"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br")])]),n("p",[n("code",[s._v("/usr/local/nginx/conf/conf.d/autorun.conf")])]),s._v(" "),n("div",{staticClass:"language-nginx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-nginx"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v("       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("9001")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server_name")]),s._v("  localhost"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("large_client_header_buffers")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v("k"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#header大小")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("client_max_body_size")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("300")]),s._v("m"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#上传文件大小限制")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("client_body_buffer_size")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("128")]),s._v("k"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#缓冲区大小")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_connect_timeout")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("600")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#设置与upstream server的连接超时时间")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_read_timeout")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("600")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#设置与代理服务器的读超时时间")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_send_timeout")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("600")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#发送请求给upstream服务器的超时时间")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("underscores_in_headers")]),s._v(" on"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#header允许使用带'_'的参数")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#注意这个设置防止docker环境下，刷新端口没有的问题；")]),s._v("\n    absolute_redirect off"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 统一门户前端")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n       "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("app"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("AAWeb"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("AAPortal"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n       "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("html "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("htm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n       "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try_files")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$uri")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$uri")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n     "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("^")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("modules "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n     "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("app"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("AAWeb"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n   "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("aiFactoryServer "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_pass")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("http")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("9005")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("aiFactoryServer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" Host "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$host")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" X"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Real"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("IP "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_addr")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" REMOTE"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("HOST "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_addr")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" X"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Forwarded"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("For "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$proxy_add_x_forwarded_for")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#巡检工具本地测试")]),s._v("\n   "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("autorunweb "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_pass")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("http")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8082")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("autorunweb"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" Host "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$host")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" X"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Real"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("IP "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_addr")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" REMOTE"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("HOST "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_addr")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" X"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Forwarded"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("For "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$proxy_add_x_forwarded_for")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#实时引擎")]),s._v("\n   "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ZRealTEng "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_pass")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("http")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8089")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ZRealTEng"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" Host "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$host")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" X"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Real"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("IP "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_addr")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" REMOTE"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("HOST "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_addr")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" X"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Forwarded"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("For "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$proxy_add_x_forwarded_for")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("error_page")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("500")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("502")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("503")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("504")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v("x"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v("x"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("html "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("usr"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("share"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br")])]),n("p",[s._v("简化为一个配置,"),n("code",[s._v("nginx.conf")]),s._v(",并优化端口调整问题；")]),s._v(" "),n("div",{staticClass:"language-nginx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-nginx"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#user  nobody;")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("worker_processes")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#error_log  logs/error.log;")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#error_log  logs/error.log  notice;")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# error_log  logs/error.log  info;")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("error_log")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("var"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("log"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("error"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("log warn"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# pid        logs/nginx.pid;")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("pid")]),s._v("        "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("var"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("run"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("pid")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("events")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("worker_connections")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("http")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("include")]),s._v("       mime"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("types")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default_type")]),s._v("  application"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("octet"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("stream"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("log_format")]),s._v("  main  "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'$remote_addr - $remote_user [$time_local] \"$request\" '")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'$status $body_bytes_sent \"$http_referer\" '")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'"$http_user_agent" "$http_x_forwarded_for"\'')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# access_log  logs/access.log  main;")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("access_log")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("var"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("log"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("access"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("log  main"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("sendfile")]),s._v("        on"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#tcp_nopush     on;")]),s._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#keepalive_timeout  0;")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("keepalive_timeout")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("65")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#gzip  on;")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("client_max_body_size")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("500")]),s._v("m"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#include /usr/local/nginx/conf/conf.d/*.conf;")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v("       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server_name")]),s._v("  localhost"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("large_client_header_buffers")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v("k"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#header大小")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("client_max_body_size")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("300")]),s._v("m"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#上传文件大小限制")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("client_body_buffer_size")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("128")]),s._v("k"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#缓冲区大小")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_connect_timeout")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("600")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#设置与upstream server的连接超时时间")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_read_timeout")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("600")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#设置与代理服务器的读超时时间")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_send_timeout")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("600")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#发送请求给upstream服务器的超时时间")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("underscores_in_headers")]),s._v(" on"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#header允许使用带'_'的参数")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#proxy_set_header X-Forwarded-Host $host;")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#proxy_set_header X-Forwarded-Server $host;")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#proxy_set_header Host $host:$server_port; #这里是重点,这样配置才不会丢失端口")]),s._v("\n    absolute_redirect off"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 统一门户前端")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("srv"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("app"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("portal"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("AAWeb"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("html "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("htm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try_files")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$uri")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$uri")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#location ^~ /modules {")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  root   /srv/app/portal/AAWeb;")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#}")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("aiFactoryServer "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_pass")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("http")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("9005")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("aiFactoryServer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" Host "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$host")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" X"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Real"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("IP "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_addr")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" REMOTE"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("HOST "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_addr")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" X"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Forwarded"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("For "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$proxy_add_x_forwarded_for")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#巡检工具本地测试")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("autorunweb "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_pass")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("http")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8082")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("autorunweb"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" Host "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$host")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" X"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Real"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("IP "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_addr")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" REMOTE"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("HOST "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_addr")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" X"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Forwarded"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("For "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$proxy_add_x_forwarded_for")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#实时引擎")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ZRealTEng "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_pass")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("http")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8089")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ZRealTEng"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" Host "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$host")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" X"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Real"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("IP "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_addr")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" REMOTE"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("HOST "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_addr")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" X"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Forwarded"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("For "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$proxy_add_x_forwarded_for")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("error_page")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("500")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("502")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("503")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("504")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v("x"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v("x"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("html "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("usr"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("share"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br"),n("span",{staticClass:"line-number"},[s._v("70")]),n("br"),n("span",{staticClass:"line-number"},[s._v("71")]),n("br"),n("span",{staticClass:"line-number"},[s._v("72")]),n("br"),n("span",{staticClass:"line-number"},[s._v("73")]),n("br"),n("span",{staticClass:"line-number"},[s._v("74")]),n("br"),n("span",{staticClass:"line-number"},[s._v("75")]),n("br"),n("span",{staticClass:"line-number"},[s._v("76")]),n("br"),n("span",{staticClass:"line-number"},[s._v("77")]),n("br"),n("span",{staticClass:"line-number"},[s._v("78")]),n("br"),n("span",{staticClass:"line-number"},[s._v("79")]),n("br"),n("span",{staticClass:"line-number"},[s._v("80")]),n("br"),n("span",{staticClass:"line-number"},[s._v("81")]),n("br"),n("span",{staticClass:"line-number"},[s._v("82")]),n("br"),n("span",{staticClass:"line-number"},[s._v("83")]),n("br"),n("span",{staticClass:"line-number"},[s._v("84")]),n("br"),n("span",{staticClass:"line-number"},[s._v("85")]),n("br"),n("span",{staticClass:"line-number"},[s._v("86")]),n("br"),n("span",{staticClass:"line-number"},[s._v("87")]),n("br"),n("span",{staticClass:"line-number"},[s._v("88")]),n("br"),n("span",{staticClass:"line-number"},[s._v("89")]),n("br"),n("span",{staticClass:"line-number"},[s._v("90")]),n("br"),n("span",{staticClass:"line-number"},[s._v("91")]),n("br"),n("span",{staticClass:"line-number"},[s._v("92")]),n("br"),n("span",{staticClass:"line-number"},[s._v("93")]),n("br"),n("span",{staticClass:"line-number"},[s._v("94")]),n("br"),n("span",{staticClass:"line-number"},[s._v("95")]),n("br"),n("span",{staticClass:"line-number"},[s._v("96")]),n("br")])]),n("p",[n("strong",[s._v("安全部分优化处理：")])]),s._v(" "),n("div",{staticClass:"language-nginx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-nginx"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# API接口的路径不允许给外部开放")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("aiFactoryServer"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("api"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("deny")]),s._v(" all"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("access_log")]),s._v(" off"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("log_not_found")]),s._v(" off"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("logos "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("home"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("bdpcloud"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("portal"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("GSMAppWeb"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("daweb"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("html "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("htm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try_files")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$uri")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$uri")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("p",[n("strong",[s._v("有前缀部分优化处理：")])]),s._v(" "),n("p",[s._v("前端配置：")]),s._v(" "),n("div",{staticClass:"language-nginx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-nginx"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# base指定页面路由的前缀，比如/bdpPortal，默认值：/")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# https://umijs.org/zh/config/#base")]),s._v("\nbase"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("daweb\n\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# publicPath指定静态资源的前缀，比如/bdpPortal，默认值：/")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这个参数跟base的区别是：base是指定路由，publicPath是针对html、css、js、img、svg等静态资源的前缀")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# https://umijs.org/zh/config/#publicpath")]),s._v("\npublicPath"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("daweb"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("p",[s._v("源码路径在：")]),s._v(" "),n("p",[s._v("/srv/app/portal/AAWeb/daweb下面；")]),s._v(" "),n("div",{staticClass:"language-nginx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-nginx"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("daweb "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("srv"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("app"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("portal"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("AAWeb"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("html "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("htm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try_files")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$uri")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$uri")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#location ^~ /modules {")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# root   /srv/app/portal/AAWeb;")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("daweb"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("aiFactoryServer "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_pass")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("http")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("9005")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("aiFactoryServer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" Host "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$host")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" X"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Real"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("IP "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_addr")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" REMOTE"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("HOST "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_addr")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" X"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Forwarded"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("For "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$proxy_add_x_forwarded_for")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("daweb"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("autorunweb "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_pass")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("http")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8082")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("autorunweb"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" Host "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$host")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" X"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Real"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("IP "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_addr")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" REMOTE"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("HOST "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_addr")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" X"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Forwarded"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("For "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$proxy_add_x_forwarded_for")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br")])]),n("p",[s._v("初始化启动")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# netstat -antlp")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"启动nginx..."')]),s._v("\nnginx -g "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"daemon off;"')]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("h4",{attrs:{id:"redis"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#redis"}},[s._v("#")]),s._v(" redis")]),s._v(" "),n("p",[s._v("源码安装")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# install redis")]),s._v("\nRUN "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$WORKDIR")]),s._v("/soft/redis "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" -zxvf  redis-3.2.11.tar.gz "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" redis-3.2.11 "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("PREFIX")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/redis "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ln")]),s._v(" -s /usr/local/redis/bin/redis-cli /usr/bin/redis-cli "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ln")]),s._v(" -s /usr/local/redis/bin/redis-server /usr/bin/redis "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" -rf "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("/redis-3.2* "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" -rf "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$WORKDIR")]),s._v("/soft/redis/redis.conf /usr/local/redis/\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("p",[s._v("初始化启动")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('  echo "启动redis..."\n  redis /usr/local/redis/redis.conf\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("h4",{attrs:{id:"mysql"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#mysql"}},[s._v("#")]),s._v(" mysql")]),s._v(" "),n("p",[s._v("源码安装")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[s._v("RUN yum -y "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" yum-utils "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" gcc-c++ libtool zlib zlib-devel "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("unzip")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("zip")]),s._v("  gettext pcre pcre-devel openssl openssl-devel "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" yum -y "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" openssh-server openssh-clients "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" yum -y "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" libaio  net-tools numactl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" yum clean all\nENV "),n("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("LANG")]),s._v(" en_US.UTF-8\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# install mysql")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# RUN yum install -y libaio  net-tools numactl")]),s._v("\nRUN "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("useradd")]),s._v(" -s /sbin/nologin mysql "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p /var/lib/mysql/data "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" -R root /var/lib/mysql "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" -R mysql:mysql /var/lib/mysql "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" -R mysql /var/lib/mysql/data \nRUN "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$WORKDIR")]),s._v("/soft/mysql "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" -zxvf mysql-5.7.35.tar.gz "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" mysql-5.7.35 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rpm")]),s._v(" -ivh mysql-community-common-5.7.35-1.el7.x86_64.rpm "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rpm")]),s._v(" -ivh mysql-community-libs-5.7.35-1.el7.x86_64.rpm "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rpm")]),s._v(" -ivh mysql-community-client-5.7.35-1.el7.x86_64.rpm "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rpm")]),s._v(" -ivh mysql-community-server-5.7.35-1.el7.x86_64.rpm "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" -rf "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("/mysql-5.7* "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" -rf "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$WORKDIR")]),s._v("/soft/mysql/my.cnf /etc/my.cnf\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br")])]),n("p",[s._v("初始化启动")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# start mysql and init sql")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" -rf /var/lib/mysql/* "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" mysqld --initialize --user"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("mysql --basedir"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/var/lib/mysql\n  mysqld --defaults-file"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/etc/my.cnf --user root --skip-grant-tables "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\n  mysql -uroot mysql "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/srv/app/soft/mysql/setpwd.sql\n\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" -ef "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" mysqld "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" -v "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'{print "kill -9",'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$2")]),s._v("}'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"启动mysqld..."')]),s._v("\n  mysqld --defaults-file"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/etc/my.cnf --user root "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\n  mysql -uroot -p"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$ROOT_PWD")]),s._v(" --connect-expired-password mysql "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/srv/app/soft/mysql/init.sql\n\n  "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"初始化数据库..."')]),s._v("\n  mysql -uroot -p"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$MYSQL_PWD")]),s._v(" -e "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\n  CREATE DATABASE IF NOT EXISTS dataportal DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;\n  CREATE DATABASE IF NOT EXISTS autorun DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;\n  quit\n  "')]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"导入门户数据..."')]),s._v("\n  mysql -uroot -p"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$MYSQL_PWD")]),s._v(" dataportal "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/srv/app/portal/dataportal.sql\n  "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"导入巡检后端数据..."')]),s._v("\n  mysql -uroot -p"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$MYSQL_PWD")]),s._v(" autorun "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/srv/app/autorun/autorun.sql\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br")])]),n("h4",{attrs:{id:"sshd"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#sshd"}},[s._v("#")]),s._v(" sshd")]),s._v(" "),n("p",[s._v("源码安装")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" yum -y "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" openssh-server openssh-clients "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("初始化启动")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[s._v("  "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"容器init初始化模式..."')]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 默认容器密码")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"root:'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${ROOT_PWD}")]),s._v('"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" chpasswd\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#start sshd")]),s._v("\n  ssh-keygen -A\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#免密码本机跳本机")]),s._v("\n  ssh-keygen -t rsa -P "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v(" -f ~/.ssh/id_rsa\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" ~/.ssh/id_rsa.pub "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v("~/.ssh/authorized_keys\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" 0600 ~/.ssh/authorized_keys\n  "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"启动sshd..."')]),s._v("\n  /usr/sbin/sshd -D "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("h4",{attrs:{id:"jdk"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#jdk"}},[s._v("#")]),s._v(" JDK")]),s._v(" "),n("p",[s._v("源码安装")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# install jdk")]),s._v("\nRUN "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$WORKDIR")]),s._v("/soft/jdk "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" -zxvf jdk-8u241-linux-x64.tar.gz "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" jdk1.8.0_241/ /usr/local/java/ "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" -rf *.gz\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[s._v("初始化启动")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[s._v("ENV "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("JAVA_HOME")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/java\nENV "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("JRE_HOME")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/java/jre\nENV "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("CLASSPATH")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(".:"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$JAVA_HOME")]),s._v("/lib/dt.jar:"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$JAVA_HOME")]),s._v("/lib/tools.jar:"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$JRE_HOME")]),s._v("/lib:"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$CLASSPATH")]),s._v("\nENV "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[n("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("PATH")])]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$PATH")]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$JAVA_HOME")]),s._v("/bin\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[s._v("  "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p /usr/lib/jvm/\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ln")]),s._v(" -s /usr/local/java /usr/lib/jvm/jdk1.8.0_241\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("h3",{attrs:{id:"jar部署"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#jar部署"}},[s._v("#")]),s._v(" jar部署")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("config")])]),s._v(" "),n("li",[n("p",[s._v("Redis,mysql,eureka地址；")])]),s._v(" "),n("li",[n("p",[s._v("license按照127.0.0.1重新修改；")])])]),s._v(" "),n("h2",{attrs:{id:"docker化部署"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#docker化部署"}},[s._v("#")]),s._v(" docker化部署")]),s._v(" "),n("h3",{attrs:{id:"readme"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#readme"}},[s._v("#")]),s._v(" README")]),s._v(" "),n("h4",{attrs:{id:"构建"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#构建"}},[s._v("#")]),s._v(" 构建")]),s._v(" "),n("ul",[n("li",[s._v("默认不使用缓存构建 "),n("code",[s._v("sh build.sh")]),s._v(";")]),s._v(" "),n("li",[s._v("使用缓存构建 "),n("code",[s._v("sh build.sh -c true")])]),s._v(" "),n("li",[s._v("构建后并发布 "),n("code",[s._v("sh build.sh -p true")])]),s._v(" "),n("li",[s._v("同时设置缓存和发布 "),n("code",[s._v("sh build.sh -c true -p true")])])]),s._v(" "),n("h4",{attrs:{id:"启动"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#启动"}},[s._v("#")]),s._v(" 启动")]),s._v(" "),n("ul",[n("li",[s._v("默认不使用缓存启动 "),n("code",[s._v("sh start.sh")]),s._v(";")]),s._v(" "),n("li",[s._v("使用干净重置启动 "),n("code",[s._v("sh start.sh true")])])]),s._v(" "),n("h4",{attrs:{id:"不用脚本方式启动"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#不用脚本方式启动"}},[s._v("#")]),s._v(" 不用脚本方式启动")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[s._v("docker run -d "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  -p "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("28080")]),s._v(":80 -p "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("26379")]),s._v(":6379 -p "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("23306")]),s._v(":3306 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  -v /data/autorun/mysql/log:/var/log/mysql "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  -v /data/autorun/mysql/data:/var/lib/mysql "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --name autorun-pro autorun-pro\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker exec -it autorun-pro bash")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# curl localhost")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("p",[n("img",{attrs:{src:t(431),alt:"image-20220303171158659"}})]),s._v(" "),n("h3",{attrs:{id:"完全跑通脚本"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#完全跑通脚本"}},[s._v("#")]),s._v(" 完全跑通脚本")]),s._v(" "),n("p",[n("img",{attrs:{src:t(432),alt:"image-20220221171615107"}})]),s._v(" "),n("p",[n("code",[s._v("Dockerfile")]),s._v("使用本地资源；")]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[s._v("FROM centos"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("centos7\nLABEL author=samyzh version=0.0.1\n\nRUN yum "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("y install yum"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("utils make gcc"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("c++ libtool zlib zlib"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("devel unzip zip  gettext pcre pcre"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("devel openssl openssl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("devel wget\nENV LANG en_US.UTF"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# RUN unalias cp mv rm")]),s._v("\nWORKDIR /srv/app\nCOPY . .\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# install nginx")]),s._v("\nRUN cd /srv/app/soft/nginx \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" tar "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("zxvf  nginx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("1.18.0.tar.gz \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" cd nginx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("1.18.0 "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" ./configure "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("prefix=/usr/local/nginx \\\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("pid"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("path=/var/run/nginx/nginx.pid \\\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("lock"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("path=/var/lock/nginx.lock \\\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("error"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("log"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("path=/var/log/nginx/error.log \\\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("http"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("log"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("path=/var/log/nginx/access.log \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" make "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" make install\\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" ln "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("s /usr/local/nginx/sbin/nginx /usr/sbin/nginx\nRUN unzip "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("d  /srv/app/portal/ /srv/app/portal/AAWeb.zip\nRUN cp "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("rf /srv/app/soft/nginx/nginx.conf /usr/local/nginx/conf/\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# RUN nginx")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# RUN rpm -Uvh http://nginx.org/packages/centos/7/noarch/RPMS/nginx-release-centos-7-0.el7.ngx.noarch.rpm \\")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   && yum -y install nginx")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# RUN cp -rf /srv/app/soft/nginx/nginx.conf /etc/nginx/nginx.conf")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# install redis")]),s._v("\nRUN cd /srv/app/soft/redis \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" tar "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("zxvf  redis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("3.2.11.tar.gz \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" cd redis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("3.2.11 "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" make install PREFIX=/usr/local/redis \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" ln "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("s /usr/local/redis/bin/redis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("cli /usr/bin/redis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("cli \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" ln "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("s /usr/local/redis/bin/redis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("server /usr/bin/redis\nRUN cp "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("rf /srv/app/soft/redis/redis.conf /usr/local/redis/\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# RUN redis /usr/local/redis/redis.conf")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# RUN yum install -y gcc epel-release redis")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# RUN cp -rf /srv/app/soft/redis/redis.conf /etc/redis.conf")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# install mysql")]),s._v("\nRUN yum install "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("y libaio  net"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("tools numactl\nRUN useradd "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("s /sbin/nologin mysql \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" mkdir "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("p /var/lib/mysql/data \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" chown "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("R root /var/lib/mysql \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" chown "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("R mysql"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("mysql /var/lib/mysql \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" chown "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("R mysql /var/lib/mysql/data\n\nRUN cd /srv/app/soft/mysql \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" tar "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("zxvf mysql"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("5.7.35.tar.gz \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" cd mysql"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("5.7.35 \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" rpm "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("ivh mysql"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("community"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("common"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("5.7.35"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("1.el7.x86_64.rpm \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" rpm "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("ivh mysql"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("community"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("libs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("5.7.35"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("1.el7.x86_64.rpm \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" rpm "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("ivh mysql"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("community"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("client"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("5.7.35"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("1.el7.x86_64.rpm \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" rpm "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("ivh mysql"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("community"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("server"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("5.7.35"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("1.el7.x86_64.rpm\nRUN cp "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("rf /srv/app/soft/mysql/my.cnf /etc/my.cnf\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这个配置在线安装太慢了；")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# RUN rpm -Uvh https://repo.mysql.com//mysql57-community-release-el7-11.noarch.rpm \\")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   && yum -y install mysql-community-server")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# RUN cp -rf /srv/app/soft/mysql/my.cnf /etc/my.cnf")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# install jdk")]),s._v("\nRUN cd /srv/app/soft/jdk \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" tar "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("zxvf jdk"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("8u241"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("linux"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("x64.tar.gz \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" mv jdk1.8.0_241/ /usr/local/java/ \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# RUN echo ")]),s._v("\nENV JAVA_HOME=/usr/local/java\nENV JRE_HOME=/usr/local/java/jre\nENV CLASSPATH=."),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("$JAVA_HOME/lib/dt.jar"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("$JAVA_HOME/lib/tools.jar"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("$JRE_HOME/lib"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("$CLASSPATH\nENV PATH=$PATH"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("$JAVA_HOME/bin\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# pro")]),s._v("\nRUN unzip "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("d  /srv/app/portal/ /srv/app/portal/eureka.zip\nRUN unzip "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("d  /srv/app/portal/ /srv/app/portal/GSMAppService.zip\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# RUN unzip -d  /srv/app/autorun/ /srv/app/portal/autorun.zip")]),s._v("\n\nEXPOSE 80\nEXPOSE 6379\nEXPOSE 3306\n\nENTRYPOINT "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/bin/bash"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./entrypoint.sh"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br"),n("span",{staticClass:"line-number"},[s._v("70")]),n("br"),n("span",{staticClass:"line-number"},[s._v("71")]),n("br"),n("span",{staticClass:"line-number"},[s._v("72")]),n("br"),n("span",{staticClass:"line-number"},[s._v("73")]),n("br"),n("span",{staticClass:"line-number"},[s._v("74")]),n("br"),n("span",{staticClass:"line-number"},[s._v("75")]),n("br"),n("span",{staticClass:"line-number"},[s._v("76")]),n("br"),n("span",{staticClass:"line-number"},[s._v("77")]),n("br"),n("span",{staticClass:"line-number"},[s._v("78")]),n("br"),n("span",{staticClass:"line-number"},[s._v("79")]),n("br"),n("span",{staticClass:"line-number"},[s._v("80")]),n("br"),n("span",{staticClass:"line-number"},[s._v("81")]),n("br"),n("span",{staticClass:"line-number"},[s._v("82")]),n("br")])]),n("p",[n("code",[s._v("entrypoint.sh")])]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/bin/bash")]),s._v("\nredis /usr/local/redis/redis.conf\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#nginx -c /usr/local/nginx/conf/nginx.conf")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# start mysql and init sql")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" -rf /var/lib/mysql/* "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" mysqld --initialize --user"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("mysql --basedir"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/var/lib/mysql\nmysqld --defaults-file"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/etc/my.cnf --user root --skip-grant-tables "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v(" \n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\n\nmysql -uroot mysql "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" /srv/app/soft/mysql/setpwd.sql\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" -ef"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" mysqld "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" -v "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'{print "kill -9",'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$2")]),s._v("}'")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v("\n\nmysqld --defaults-file"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/etc/my.cnf --user root "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v(" \n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\n\nmysql -uroot -proot-1234 --connect-expired-password mysql "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" /srv/app/soft/mysql/init.sql\nmysql -uroot -pPass-1234 mysql "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" /srv/app/soft/mysql/dataportal.sql\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#start portal and autorun")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /srv/app/portal/eureka "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v(" stop.sh "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v(" start.sh\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /srv/app/portal/GSMAppService "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v(" stop.sh "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v(" start.sh\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cd /srv/app/portal/autorun && sh stop.sh && sh start.sh")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# sleep 5")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("netstat")]),s._v(" -antlp\nnginx -g "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"daemon off;"')]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br")])]),n("h3",{attrs:{id:"优化基镜像"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#优化基镜像"}},[s._v("#")]),s._v(" 优化基镜像")]),s._v(" "),n("blockquote",[n("p",[s._v("源码安装的mysql,nginx, redis,jdk环境；")])]),s._v(" "),n("h4",{attrs:{id:"dockerfile"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#dockerfile"}},[s._v("#")]),s._v(" "),n("code",[s._v("Dockerfile")])]),s._v(" "),n("p",[s._v("及优化后，资源在线化； 可以通过"),n("code",[s._v("-e")]),s._v("参数动态替换URLBASE及WORKDIR；")]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[s._v("FROM centos"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("centos7\nLABEL author=samyzh version=0.0.1\n\nRUN yum "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("y install yum"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("utils make gcc"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("c++ libtool zlib zlib"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("devel unzip zip  gettext pcre pcre"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("devel openssl openssl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("devel wget\nENV LANG en_US.UTF"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("\n\nENV WORKDIR /srv/app\nENV URLBASE=http"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("//10.45.xx.xx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("58888/files/autorun/pro\n\nWORKDIR $WORKDIR\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# COPY . .")]),s._v("\nADD entrypoint.sh $WORKDIR/\n\nRUN mkdir "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("p $WORKDIR/soft/nginx "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" cd $WORKDIR/soft/nginx \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" wget $URLBASE/soft/nginx/nginx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("1.18.0.tar.gz \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" wget $URLBASE/soft/nginx/nginx.conf \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" mkdir "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("p $WORKDIR/soft/redis "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" cd $WORKDIR/soft/redis \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" wget $URLBASE/soft/redis/redis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("3.2.11.tar.gz \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" wget $URLBASE/soft/redis/redis.conf \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" mkdir "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("p $WORKDIR/soft/mysql "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" cd $WORKDIR/soft/mysql \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" wget $URLBASE/soft/mysql/mysql"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("5.7.35.tar.gz \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" wget $URLBASE/soft/mysql/my.cnf \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" wget $URLBASE/soft/mysql/init.sql \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" wget $URLBASE/soft/mysql/setpwd.sql \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" mkdir "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("p $WORKDIR/soft/jdk "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" cd $WORKDIR/soft/jdk  \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" wget $URLBASE/soft/jdk/jdk"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("8u241"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("linux"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("x64.tar.gz\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# install nginx")]),s._v("\nRUN cd /srv/app/soft/nginx \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" tar "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("zxvf  nginx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("1.18.0.tar.gz \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" cd nginx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("1.18.0 "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" ./configure "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("prefix=/usr/local/nginx \\\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("pid"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("path=/var/run/nginx/nginx.pid \\\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("lock"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("path=/var/lock/nginx.lock \\\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("error"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("log"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("path=/var/log/nginx/error.log \\\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("http"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("log"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("path=/var/log/nginx/access.log \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" make "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" make install\\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" ln "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("s /usr/local/nginx/sbin/nginx /usr/sbin/nginx\nRUN unzip "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("d  /srv/app/portal/ /srv/app/portal/AAWeb.zip\nRUN cp "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("rf /srv/app/soft/nginx/nginx.conf /usr/local/nginx/conf/\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# install redis")]),s._v("\nRUN cd /srv/app/soft/redis \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" tar "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("zxvf  redis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("3.2.11.tar.gz \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" cd redis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("3.2.11 "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" make install PREFIX=/usr/local/redis \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" ln "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("s /usr/local/redis/bin/redis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("cli /usr/bin/redis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("cli \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" ln "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("s /usr/local/redis/bin/redis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("server /usr/bin/redis\nRUN cp "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("rf /srv/app/soft/redis/redis.conf /usr/local/redis/\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# install mysql")]),s._v("\nRUN yum install "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("y libaio  net"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("tools numactl\nRUN useradd "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("s /sbin/nologin mysql \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" mkdir "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("p /var/lib/mysql/data \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" chown "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("R root /var/lib/mysql \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" chown "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("R mysql"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("mysql /var/lib/mysql \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" chown "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("R mysql /var/lib/mysql/data\nRUN cd /srv/app/soft/mysql \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" tar "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("zxvf mysql"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("5.7.35.tar.gz \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" cd mysql"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("5.7.35 \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" rpm "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("ivh mysql"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("community"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("common"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("5.7.35"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("1.el7.x86_64.rpm \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" rpm "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("ivh mysql"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("community"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("libs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("5.7.35"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("1.el7.x86_64.rpm \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" rpm "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("ivh mysql"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("community"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("client"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("5.7.35"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("1.el7.x86_64.rpm \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" rpm "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("ivh mysql"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("community"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("server"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("5.7.35"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("1.el7.x86_64.rpm\nRUN cp "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("rf /srv/app/soft/mysql/my.cnf /etc/my.cnf\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# install jdk")]),s._v("\nRUN cd /srv/app/soft/jdk \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" tar "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("zxvf jdk"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("8u241"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("linux"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("x64.tar.gz \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" mv jdk1.8.0_241/ /usr/local/java/ \nENV JAVA_HOME=/usr/local/java\nENV JRE_HOME=/usr/local/java/jre\nENV CLASSPATH=."),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("$JAVA_HOME/lib/dt.jar"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("$JAVA_HOME/lib/tools.jar"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("$JRE_HOME/lib"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("$CLASSPATH\nENV PATH=$PATH"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("$JAVA_HOME/bin\n\nEXPOSE 80\nEXPOSE 6379\nEXPOSE 3306\n\nENTRYPOINT "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/bin/bash"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./entrypoint.sh"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br"),n("span",{staticClass:"line-number"},[s._v("70")]),n("br"),n("span",{staticClass:"line-number"},[s._v("71")]),n("br"),n("span",{staticClass:"line-number"},[s._v("72")]),n("br"),n("span",{staticClass:"line-number"},[s._v("73")]),n("br"),n("span",{staticClass:"line-number"},[s._v("74")]),n("br"),n("span",{staticClass:"line-number"},[s._v("75")]),n("br"),n("span",{staticClass:"line-number"},[s._v("76")]),n("br"),n("span",{staticClass:"line-number"},[s._v("77")]),n("br"),n("span",{staticClass:"line-number"},[s._v("78")]),n("br")])]),n("h4",{attrs:{id:"entrypoint-sh"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#entrypoint-sh"}},[s._v("#")]),s._v(" "),n("code",[s._v("entrypoint.sh")])]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/bin/bash")]),s._v("\nnginx -g "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"daemon off;"')]),s._v("\n\nredis /usr/local/redis/redis.conf\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# start mysql and init sql")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" -rf /var/lib/mysql/* "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" mysqld --initialize --user"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("mysql --basedir"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/var/lib/mysql\nmysqld --defaults-file"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/etc/my.cnf --user root "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v(" \n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\nmysql -uroot mysql "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" /srv/app/soft/mysql/setpwd.sql\n\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" -ef"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" mysqld "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" -v "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'{print "kill -9",'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$2")]),s._v("}'")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" -i "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"s/\\(skip-grant-tables\\).*/#skip-grant-tables/"')]),s._v(" /etc/my.cnf\nmysqld --defaults-file"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/etc/my.cnf --user root "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v(" \n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\n\nmysql -uroot -prooxxx --connect-expired-password mysql "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" /srv/app/soft/mysql/init.sql\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br")])]),n("p",[s._v("优化后：默认不设置跳过密码处理；启动时设置；")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[s._v("redis /usr/local/redis/redis.conf\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# nginx -c /usr/local/nginx/conf/nginx.conf")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# start mysql and init sql")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" -rf /var/lib/mysql/* "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" mysqld --initialize --user"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("mysql --basedir"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/var/lib/mysql\nmysqld --defaults-file"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/etc/my.cnf --user root --skip-grant-tables "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v(" \n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\n\nmysql -uroot mysql "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" /srv/app/soft/mysql/setpwd.sql\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" -ef"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" mysqld "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" -v "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'{print "kill -9",'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$2")]),s._v("}'")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v("\nmysqld --defaults-file"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/etc/my.cnf --user root "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v(" \n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\nmysql -uroot -pxx --connect-expired-password mysql "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" /srv/app/soft/mysql/init.sql\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#初始化项目sql")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"初始化数据库..."')]),s._v("\nmysql -uroot -pPxxx -e "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\nCREATE DATABASE IF NOT EXISTS dataportal DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;\nCREATE DATABASE IF NOT EXISTS autorun DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;\nquit\n"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"导入门户数据..."')]),s._v("\nmysql -uroot -pPxxx dataportal "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" /srv/app/portal/dataportal.sql\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"导入巡检后端数据..."')]),s._v("\nmysql -uroot -pPxxx autorun "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" /srv/app/autorun/autorun.sql\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# netstat -antlp")]),s._v("\nnginx -g "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"daemon off;"')]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br")])]),n("p",[n("code",[s._v("build.sh")])]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/bin/bash")]),s._v("\ndocker build -t centos7-nginx1.18-redis3.2-mysql5.7-jdk1.8 "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("h3",{attrs:{id:"构建优化"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#构建优化"}},[s._v("#")]),s._v(" 构建优化")]),s._v(" "),n("h4",{attrs:{id:"构建脚本build-sh"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#构建脚本build-sh"}},[s._v("#")]),s._v(" 构建脚本"),n("code",[s._v("build.sh")])]),s._v(" "),n("p",[s._v("是否使用"),n("code",[s._v("cache")]),s._v("； "),n("code",[s._v("sh build.sh ture")])]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/bin/bash")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("###")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# @Author: samy")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# @email: yessz#foxmail.com")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# @time: 2022-02-12 13:21:47")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# @modAuthor: samy")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# @modTime: 2022-03-01 16:02:23")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# @desc: 构建镜像")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Copyright © 2015~2022 BDP FE")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("### ")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("PRO_NAME")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("autorun-pro\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("PRO_VERSION")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.1")]),s._v(".0\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("isCache")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("false\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("isCache")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$isCache")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n  docker build -t "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$PRO_NAME")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v("\n  docker build --no-cache -t "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$PRO_NAME")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br")])]),n("p",[s._v("再优化后，支持多个外部传递参数；")]),s._v(" "),n("p",[n("code",[s._v("sh build.sh -c true -p true")])]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/bin/bash")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("###")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# @Author: samy")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# @email: yessz#foxmail.com")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# @time: 2022-02-12 13:21:47")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# @modAuthor: samy")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# @modTime: 2022-04-28 15:05:57")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# @desc: 构建镜像")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Copyright © 2015~2022 BDP FE")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("### ")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$WORKSPACE")]),s._v("/common.sh\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("IMG_NAME")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("getEnvConf IMG_NAME"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("IMG_VERSION")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("getEnvConf IMG_VERSION"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("PRO_NAME")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("getEnvConf PRO_NAME"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"----IMG_NAME='),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$IMG_NAME")]),s._v("---IMG_VERSION="),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$IMG_VERSION")]),s._v("----PRO_NAME="),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$PRO_NAME")]),s._v('-----"')]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("isCache")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("false\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("isPush")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("false\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("HARBOR")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.45")]),s._v(".xx.116:5000/wdp\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("getopts")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"c:p:"')]),s._v(" opt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("case")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$opt")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v("\n    c"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"参数C的值'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$OPTARG")]),s._v('"')]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("isCache")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$OPTARG")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    p"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"参数P的值'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$OPTARG")]),s._v('"')]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("isPush")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$OPTARG")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    ?"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"未知参数"')]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("esac")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("done")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$isCache")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n  docker build -t "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$IMG_NAME")]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$IMG_VERSION")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v("\n  docker build --no-cache -t "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$IMG_NAME")]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$IMG_VERSION")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$isPush")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  docker tag autorun-pro 10.45.46.116:5000/wdp/autorun-pro:latest")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  docker push 10.45.46.116:5000/wdp/autorun-pro:latest")]),s._v("\n docker tag "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$IMG_NAME")]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$IMG_VERSION")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$HARBOR")]),s._v("/"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$IMG_NAME")]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$IMG_VERSION")]),s._v("\n docker push "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$HARBOR")]),s._v("/"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$IMG_NAME")]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$IMG_VERSION")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br")])]),n("p",[s._v("加入提示功能：")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#使用说明，用来提示输入参数")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("usage")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Usage: sh 执行脚本.sh [init]"')]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#根据输入参数，选择执行对应方法，不输入则执行使用说明")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("case")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v('"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"init"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    init\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  *"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    usage\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("esac")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br")])]),n("h4",{attrs:{id:"容器启动脚本start-sh"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#容器启动脚本start-sh"}},[s._v("#")]),s._v(" 容器启动脚本"),n("code",[s._v("start.sh")])]),s._v(" "),n("blockquote",[n("p",[n("code",[s._v("sh start.sh true")])])]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/bin/bash")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("###")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# @Author: samy")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# @email: yessz#foxmail.com")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# @time: 2022-02-18 13:21:47")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# @modAuthor: samy")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# @modTime: 2022-03-07 10:05:21")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# @desc: 容器启动")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Copyright © 2015~2022 BDP FE")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("### ")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("PRO_NAME")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("autorun-pro\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("PRO_VERSION")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("latest \n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("isRemove")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("false\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("isRemove")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$isRemove")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"---容器stop,rm---再run处理---"')]),s._v("\n    docker stop "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$PRO_NAME")]),s._v("\n    docker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$PRO_NAME")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("EXIST")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),s._v("docker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" -a "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" $PRO_NAME "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("wc")]),s._v(" -l"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$EXIST")]),s._v(" -ne "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("STATUS")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),s._v("docker inspect -f "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{{.State.Status}}'")]),s._v(" $PRO_NAME"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("case")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$STATUS")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"running"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"---容器是running状态---将不做处理---"')]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"exited"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"---容器是exited状态---将start处理..."')]),s._v("\n            docker start "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$PRO_NAME")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"paused"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"---容器是paused状态---将unpause处理..."')]),s._v("\n            docker unpause "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$PRO_NAME")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"created"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"---容器是created状态---将start处理..."')]),s._v("\n            docker start "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$PRO_NAME")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        *"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"---容器是特殊状态---暂时没有处理..."')]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("esac")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"---检查到容器不存在---将run处理中..."')]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p /home/wdp/autorun/role_template\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" ./host_role.csv /home/wdp/autorun/role_template/host_role.csv\n  docker run -d "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    -p "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("28080")]),s._v(":80 -p "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("26379")]),s._v(":6379 -p "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("23306")]),s._v(":3306 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    -v /data/autorun/mysql/log:/var/log/mysql "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    -v /data/autorun/mysql/data:/var/lib/mysql "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    -v /home/wdp/autorun/role_template:/root/app/autorun/role_template "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    --name "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$PRO_NAME")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$PRO_NAME")]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$PRO_VERSION")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\ndocker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" -a "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$PRO_NAME")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker exec -it autorun-pro bash")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# curl localhost")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br")])]),n("p",[n("code",[s._v("--privileged")]),s._v("参数：")]),s._v(" "),n("p",[s._v("参数启动容器"),n("code",[s._v("--privileged")]),s._v("否则SSH连接异常;")]),s._v(" "),n("p",[n("img",{attrs:{src:t(433),alt:"image-20220325112135047"}})]),s._v(" "),n("h4",{attrs:{id:"清空无用容器-镜像脚本clean-sh"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#清空无用容器-镜像脚本clean-sh"}},[s._v("#")]),s._v(" 清空无用容器/镜像脚本"),n("code",[s._v("clean.sh")])]),s._v(" "),n("p",[s._v("开始版本TODO")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/bin/bash")]),s._v("\ndocker stop "),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("docker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" -a "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Exited"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{print "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v(" }'")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#停止容器  ")]),s._v("\ndocker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("docker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" -a "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Exited"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{print "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v(" }'")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#删除容器 ")]),s._v("\ndocker rmi "),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("docker images "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"none"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{print "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$3")]),s._v("}'")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#删除镜像")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[s._v("只做none的镜像处理：")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/bin/bash")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("###")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# @Author: samy")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# @email: yessz#foxmail.com")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# @time: 2022-02-18 13:21:47")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# @modAuthor: samy")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# @modTime: 2022-03-04 14:51:31")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# @desc: 移除不必要的容器和镜像")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Copyright © 2015~2022 BDP FE")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("### ")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# set +e")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker rmi $(docker images | grep \"none\" | awk '{print $3}')")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ctnExit=`docker ps -a | grep \"Exited\" | awk '{print $1 }' | wc -l`")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# imgNone=`docker images | grep \"none\" | awk '{print $3}' | wc -l`")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# if [ $ctnExit -ne 0 ];then")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#   echo "111"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   # docker rm -v $(docker ps -aq -f status=exited)")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   docker stop $(docker ps -a | grep \"Exited\" | awk '{print $1 }')")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   docker rm $(docker ps -a | grep \"Exited\" | awk '{print $1 }')")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   if [ $imgNone -ne 0 ];then")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#     echo "333"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#     docker rmi $(docker images | grep \"none\" | awk '{print $3}')")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   else")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#     echo "444"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   fi")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# else")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#   echo "222"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   if [ $imgNone -ne 0 ];then")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#     echo "555"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#     docker rmi $(docker images | grep \"none\" | awk '{print $3}')")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   else")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#     echo "666"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   fi")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# fi")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("try")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" $- "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" *e* "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("SAVED_OPT_E")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$?")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" +e\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("throw")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("catch")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ex_code")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$?")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("((")]),s._v(" $SAVED_OPT_E "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")])]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" +e\n    "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("return")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$ex_code")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("AnException")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n\ntry\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(" \n    "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"------remove none images------"')]),s._v("\n    docker rmi "),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("docker images "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"none"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{print "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$3")]),s._v("}'")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" throw "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$AnException")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"------finished------"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\ncatch "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("case")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$ex_code")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$AnException")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"AnException was thrown"')]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        *"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"An unexpected exception was thrown"')]),s._v("\n            throw "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$ex_code")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("esac")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br")])]),n("h2",{attrs:{id:"动态构建部署"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#动态构建部署"}},[s._v("#")]),s._v(" 动态构建部署")]),s._v(" "),n("h3",{attrs:{id:"构建思路"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#构建思路"}},[s._v("#")]),s._v(" 构建思路")]),s._v(" "),n("blockquote",[n("p",[s._v("总的四个JKS项目，构建联动；")])]),s._v(" "),n("p",[s._v("【门户项目一工程】 变动  + 【巡检项目一工程】 变动  生成后zip和jar文件拷贝上传到files目录[httpd]服务；")]),s._v(" "),n("p",[s._v("===> 触发下游【Dockerfile构建】不用缓存方式构建")]),s._v(" "),n("p",[s._v("===>【启动容器项目】销毁后再重新拉起来；")]),s._v(" "),n("h3",{attrs:{id:"实践配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#实践配置"}},[s._v("#")]),s._v(" 实践配置")]),s._v(" "),n("h4",{attrs:{id:"前端门户项目"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#前端门户项目"}},[s._v("#")]),s._v(" 前端门户项目")]),s._v(" "),n("p",[n("code",[s._v("autorun-web-dev")])]),s._v(" "),n("p",[s._v("库设置")]),s._v(" "),n("p",[n("img",{attrs:{src:t(434),alt:"image-20220301161751596"}})]),s._v(" "),n("p",[n("img",{attrs:{src:t(435),alt:"image-20220301161957106"}})]),s._v(" "),n("p",[n("code",[s._v("shell")])]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("envName")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("awdp\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("httpdPath")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/var/www/html/files/autorun/pro/portal\n\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$WORKSPACE")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" -rf dist dist.zip\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" ./node\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" --registry"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("https://registry.npm.taobao.org/\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" run "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" addUser xx "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("xx")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" run clone "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("env")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$envName")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("/\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" --registry"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("https://registry.npm.taobao.org/\n\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" run build "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("env")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$envName")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("zip")]),s._v(" -r AAWeb.zip dist\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" -rf AAWeb.zip "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$httpdPath")]),s._v("/\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br")])]),n("p",[s._v("设置后面构建项目")]),s._v(" "),n("p",[n("img",{attrs:{src:t(436),alt:"image-20220301162051431"}})]),s._v(" "),n("h4",{attrs:{id:"docker项目"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#docker项目"}},[s._v("#")]),s._v(" docker项目")]),s._v(" "),n("p",[n("code",[s._v("autorun-docker-dev")])]),s._v(" "),n("p",[s._v("配置设置")]),s._v(" "),n("p",[n("img",{attrs:{src:t(437),alt:"image-20220301162452091"}})]),s._v(" "),n("p",[s._v("设置构建依赖项目")]),s._v(" "),n("p",[n("img",{attrs:{src:t(438),alt:"image-20220301162647613"}})]),s._v(" "),n("p",[n("code",[s._v("shell")])]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("PRO_NAME")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("autorun-pro\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("PRO_VERSION")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.1")]),s._v(".0\n\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$WORKSPACE")]),s._v("/pro\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v(" build.sh\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#上传私有镜像Docker hub")]),s._v("\ndocker tag "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$PRO_NAME")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(".xxx:5000/wdp/"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$PRO_NAME")]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$PRO_VERSION")]),s._v("\ndocker push "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(".xxx:5000/wdp/"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$PRO_NAME")]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$PRO_VERSION")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看是否构建成功")]),s._v("\ndocker images "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$PRO_NAME")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#移除多余的none和没用的容器")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#sh remove-none-img.sh")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br")])]),n("h4",{attrs:{id:"总体依赖"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#总体依赖"}},[s._v("#")]),s._v(" 总体依赖")]),s._v(" "),n("p",[n("img",{attrs:{src:t(439),alt:"image-20220309162521826"}})]),s._v(" "),n("p",[n("img",{attrs:{src:t(440),alt:"image-20220301165626453"}})]),s._v(" "),n("p",[n("img",{attrs:{src:t(441),alt:"image-20220301163134527"}})]),s._v(" "),n("p",[n("img",{attrs:{src:t(442),alt:"image-20220301165532548"}})]),s._v(" "),n("h2",{attrs:{id:"实践"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#实践"}},[s._v("#")]),s._v(" 实践")]),s._v(" "),n("h3",{attrs:{id:"备份"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#备份"}},[s._v("#")]),s._v(" 备份")]),s._v(" "),n("h4",{attrs:{id:"dockerfile-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#dockerfile-2"}},[s._v("#")]),s._v(" "),n("code",[s._v("Dockerfile")])]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("###")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# @Author: samy")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# @email: yessz#foxmail.com")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# @time: 2022-02-12 13:21:47")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# @modAuthor: samy")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# @modTime: 2022-02-28 13:28:20")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# @desc: Dockerfile")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Copyright © 2015~2022 BDP FE")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("### ")]),s._v("\nFROM centos"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("centos7\nLABEL author=samyzh version=0.1.0\n\nRUN yum "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("y install yum"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("utils make gcc"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("c++ libtool zlib zlib"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("devel unzip zip  gettext pcre pcre"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("devel openssl openssl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("devel wget \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" yum "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("y install openssh"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("server openssh"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("clients \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" yum "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("y install libaio  net"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("tools numactl\\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" yum clean all\nENV LANG en_US.UTF"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("\n\nENV WORKDIR=/srv/app\nENV URLBASE=http"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("//xxxx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("58888/files/autorun/pro\n\nWORKDIR $WORKDIR\nADD entrypoint.sh .\n\nRUN mkdir "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("p $WORKDIR/soft/nginx "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" cd $WORKDIR/soft/nginx \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" wget $URLBASE/soft/nginx/nginx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("1.18.0.tar.gz \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" wget $URLBASE/soft/nginx/nginx.conf \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" mkdir "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("p $WORKDIR/soft/redis "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" cd $WORKDIR/soft/redis \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" wget $URLBASE/soft/redis/redis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("3.2.11.tar.gz \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" wget $URLBASE/soft/redis/redis.conf \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" mkdir "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("p $WORKDIR/soft/mysql "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" cd $WORKDIR/soft/mysql \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" wget $URLBASE/soft/mysql/mysql"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("5.7.35.tar.gz \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" wget $URLBASE/soft/mysql/my.cnf \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" wget $URLBASE/soft/mysql/init.sql \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" wget $URLBASE/soft/mysql/setpwd.sql \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" mkdir "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("p $WORKDIR/soft/jdk "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" cd $WORKDIR/soft/jdk  \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" wget $URLBASE/soft/jdk/jdk"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("8u241"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("linux"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("x64.tar.gz\n\nRUN mkdir "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("p $WORKDIR/portal "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" cd $WORKDIR/portal \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" wget $URLBASE/portal/AAWeb.zip \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" wget $URLBASE/portal/eureka.zip \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" wget $URLBASE/portal/GSMAppService.zip \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" wget $URLBASE/portal/dataportal.sql \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" mkdir "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("p $WORKDIR/autorun "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" cd $WORKDIR/autorun \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" wget $URLBASE/autorun/autorun.tar.gz \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" wget $URLBASE/autorun/zookeeper"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("3.4.8.tar.gz \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" wget $URLBASE/autorun/autorun.sql \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" wget $URLBASE/autorun/update.tar.gz\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# install nginx")]),s._v("\nRUN cd $WORKDIR/soft/nginx \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" tar "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("zxvf  nginx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("1.18.0.tar.gz \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" cd nginx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("1.18.0 "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" ./configure "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("prefix=/usr/local/nginx \\\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("pid"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("path=/var/run/nginx/nginx.pid \\\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("lock"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("path=/var/lock/nginx.lock \\\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("error"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("log"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("path=/var/log/nginx/error.log \\\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("http"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("log"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("path=/var/log/nginx/access.log \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" make "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" make install\\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" ln "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("s /usr/local/nginx/sbin/nginx /usr/sbin/nginx \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" rm "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("rf ../"),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("*.gz")]),s._v(" \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" cp "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("rf $WORKDIR/soft/nginx/nginx.conf /usr/local/nginx/conf/\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# install redis")]),s._v("\nRUN cd $WORKDIR/soft/redis \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" tar "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("zxvf  redis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("3.2.11.tar.gz \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" cd redis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("3.2.11 "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" make install PREFIX=/usr/local/redis \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" ln "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("s /usr/local/redis/bin/redis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("cli /usr/bin/redis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("cli \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" ln "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("s /usr/local/redis/bin/redis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("server /usr/bin/redis \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" rm "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("rf ../redis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("3.2* \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" cp "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("rf $WORKDIR/soft/redis/redis.conf /usr/local/redis/\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# install mysql")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# RUN yum install -y libaio  net-tools numactl")]),s._v("\nRUN useradd "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("s /sbin/nologin mysql \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" mkdir "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("p /var/lib/mysql/data \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" chown "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("R root /var/lib/mysql \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" chown "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("R mysql"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("mysql /var/lib/mysql \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" chown "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("R mysql /var/lib/mysql/data \nRUN cd $WORKDIR/soft/mysql \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" tar "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("zxvf mysql"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("5.7.35.tar.gz \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" cd mysql"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("5.7.35 \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" rpm "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("ivh mysql"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("community"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("common"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("5.7.35"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("1.el7.x86_64.rpm \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" rpm "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("ivh mysql"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("community"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("libs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("5.7.35"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("1.el7.x86_64.rpm \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" rpm "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("ivh mysql"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("community"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("client"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("5.7.35"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("1.el7.x86_64.rpm \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" rpm "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("ivh mysql"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("community"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("server"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("5.7.35"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("1.el7.x86_64.rpm \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" rm "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("rf ../mysql"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("5.7* \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" cp "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("rf $WORKDIR/soft/mysql/my.cnf /etc/my.cnf\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# install jdk")]),s._v("\nRUN cd $WORKDIR/soft/jdk \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" tar "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("zxvf jdk"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("8u241"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("linux"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("x64.tar.gz \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" mv jdk1.8.0_241/ /usr/local/java/ \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" rm "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("rf "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("*.gz")]),s._v("\nENV JAVA_HOME=/usr/local/java\nENV JRE_HOME=/usr/local/java/jre\nENV CLASSPATH=."),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("$JAVA_HOME/lib/dt.jar"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("$JAVA_HOME/lib/tools.jar"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("$JRE_HOME/lib"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("$CLASSPATH\nENV PATH=$PATH"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("$JAVA_HOME/bin\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# pro")]),s._v("\nRUN cd $WORKDIR/portal \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" unzip "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("o $WORKDIR/portal/eureka.zip \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" unzip "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("o $WORKDIR/portal/GSMAppService.zip \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" unzip "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("o $WORKDIR/portal/AAWeb.zip \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" mv dist AAWeb \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" rm "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("rf "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("*.zip")]),s._v("\nRUN cd $WORKDIR/autorun \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" tar "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("zxvf zookeeper"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("3.4.8.tar.gz \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" tar "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("zxvf autorun.tar.gz \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" tar "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("zxvf update.tar.gz \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" rm "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("rf "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("*.gz")]),s._v("\n\nEXPOSE 80 6379 3306\n\nENTRYPOINT "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/bin/bash"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./entrypoint.sh"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br"),n("span",{staticClass:"line-number"},[s._v("70")]),n("br"),n("span",{staticClass:"line-number"},[s._v("71")]),n("br"),n("span",{staticClass:"line-number"},[s._v("72")]),n("br"),n("span",{staticClass:"line-number"},[s._v("73")]),n("br"),n("span",{staticClass:"line-number"},[s._v("74")]),n("br"),n("span",{staticClass:"line-number"},[s._v("75")]),n("br"),n("span",{staticClass:"line-number"},[s._v("76")]),n("br"),n("span",{staticClass:"line-number"},[s._v("77")]),n("br"),n("span",{staticClass:"line-number"},[s._v("78")]),n("br"),n("span",{staticClass:"line-number"},[s._v("79")]),n("br"),n("span",{staticClass:"line-number"},[s._v("80")]),n("br"),n("span",{staticClass:"line-number"},[s._v("81")]),n("br"),n("span",{staticClass:"line-number"},[s._v("82")]),n("br"),n("span",{staticClass:"line-number"},[s._v("83")]),n("br"),n("span",{staticClass:"line-number"},[s._v("84")]),n("br"),n("span",{staticClass:"line-number"},[s._v("85")]),n("br"),n("span",{staticClass:"line-number"},[s._v("86")]),n("br"),n("span",{staticClass:"line-number"},[s._v("87")]),n("br"),n("span",{staticClass:"line-number"},[s._v("88")]),n("br"),n("span",{staticClass:"line-number"},[s._v("89")]),n("br"),n("span",{staticClass:"line-number"},[s._v("90")]),n("br"),n("span",{staticClass:"line-number"},[s._v("91")]),n("br"),n("span",{staticClass:"line-number"},[s._v("92")]),n("br"),n("span",{staticClass:"line-number"},[s._v("93")]),n("br"),n("span",{staticClass:"line-number"},[s._v("94")]),n("br"),n("span",{staticClass:"line-number"},[s._v("95")]),n("br"),n("span",{staticClass:"line-number"},[s._v("96")]),n("br"),n("span",{staticClass:"line-number"},[s._v("97")]),n("br"),n("span",{staticClass:"line-number"},[s._v("98")]),n("br"),n("span",{staticClass:"line-number"},[s._v("99")]),n("br"),n("span",{staticClass:"line-number"},[s._v("100")]),n("br"),n("span",{staticClass:"line-number"},[s._v("101")]),n("br"),n("span",{staticClass:"line-number"},[s._v("102")]),n("br"),n("span",{staticClass:"line-number"},[s._v("103")]),n("br"),n("span",{staticClass:"line-number"},[s._v("104")]),n("br"),n("span",{staticClass:"line-number"},[s._v("105")]),n("br"),n("span",{staticClass:"line-number"},[s._v("106")]),n("br"),n("span",{staticClass:"line-number"},[s._v("107")]),n("br"),n("span",{staticClass:"line-number"},[s._v("108")]),n("br"),n("span",{staticClass:"line-number"},[s._v("109")]),n("br"),n("span",{staticClass:"line-number"},[s._v("110")]),n("br"),n("span",{staticClass:"line-number"},[s._v("111")]),n("br"),n("span",{staticClass:"line-number"},[s._v("112")]),n("br"),n("span",{staticClass:"line-number"},[s._v("113")]),n("br"),n("span",{staticClass:"line-number"},[s._v("114")]),n("br")])]),n("h4",{attrs:{id:"entrypoint-sh-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#entrypoint-sh-2"}},[s._v("#")]),s._v(" "),n("code",[s._v("entrypoint.sh")])]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/bin/bash")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("###")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# @Author: samy")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# @email: yessz#foxmail.com")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# @time: 2022-02-12 13:21:47")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# @modAuthor: samy")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# @modTime: 2022-03-03 14:25:40")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# @desc: 初始化;启动sshd,redis,mysqld,nginx,数据库脚本初始化")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Copyright © 2015~2022 BDP FE")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("### ")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" -e\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 主机默认密码")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ROOT_PWD")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("xxx\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 数据库最终密码")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("MYSQL_PWD")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("xxx\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 初始化文件flag")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("FLAG_FILE")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(".initFlag\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# autorun相关改动比较大的jar")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("JAR_MGR")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("autorun-manager-1.0.jar\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("JAR_CLD")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("autorun-collectdata-1.0-SNAPSHOT-jar-with-dependencies.jar\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("JAR_AGT")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("autorun-agent-1.0.jar\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# =============================================初始化系统必要的相关服务======================================================")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" -f "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$FLAG_FILE")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"进入容器restart模式..."')]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"重启sshd..."')]),s._v("\n  /usr/sbin/sshd -D "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"重启redis..."')]),s._v("\n  redis /usr/local/redis/redis.conf\n  "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"重启mysqld..."')]),s._v("\n  mysqld --defaults-file"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/etc/my.cnf --user root "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"容器init初始化模式..."')]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 默认容器密码")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"root:'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${ROOT_PWD}")]),s._v('"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" chpasswd\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#start sshd")]),s._v("\n  ssh-keygen -A\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#免密码本机跳本机")]),s._v("\n  ssh-keygen -t rsa -P "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v(" -f ~/.ssh/id_rsa\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" ~/.ssh/id_rsa.pub "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v("~/.ssh/authorized_keys\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" 0600 ~/.ssh/authorized_keys\n  "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"启动sshd..."')]),s._v("\n  /usr/sbin/sshd -D "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"启动redis..."')]),s._v("\n  redis /usr/local/redis/redis.conf\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# nginx -c /usr/local/nginx/conf/nginx.conf")]),s._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# start mysql and init sql")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" -rf /var/lib/mysql/* "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" mysqld --initialize --user"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("mysql --basedir"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/var/lib/mysql\n  mysqld --defaults-file"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/etc/my.cnf --user root --skip-grant-tables "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\n  mysql -uroot mysql "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/srv/app/soft/mysql/setpwd.sql\n\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" -ef "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" mysqld "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" -v "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'{print "kill -9",'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$2")]),s._v("}'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"启动mysqld..."')]),s._v("\n  mysqld --defaults-file"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/etc/my.cnf --user root "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\n  mysql -uroot -p"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$ROOT_PWD")]),s._v(" --connect-expired-password mysql "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/srv/app/soft/mysql/init.sql\n\n  "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"初始化数据库..."')]),s._v("\n  mysql -uroot -p"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$MYSQL_PWD")]),s._v(" -e "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\n  CREATE DATABASE IF NOT EXISTS dataportal DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;\n  CREATE DATABASE IF NOT EXISTS autorun DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;\n  quit\n  "')]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"导入门户数据..."')]),s._v("\n  mysql -uroot -p"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$MYSQL_PWD")]),s._v(" dataportal "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/srv/app/portal/dataportal.sql\n  "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"导入巡检后端数据..."')]),s._v("\n  mysql -uroot -p"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$MYSQL_PWD")]),s._v(" autorun "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/srv/app/autorun/autorun.sql\n\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#创建软链： 只做一次处理")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p /usr/lib/jvm/\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ln")]),s._v(" -s /usr/local/java /usr/lib/jvm/jdk1.8.0_241\n\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p /usr/java/jdk1.7.0_67-cloudera/bin\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ln")]),s._v(" -s /usr/local/java/bin/java /usr/java/jdk1.7.0_67-cloudera/bin/java\n\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#创建脚本路径")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p /root/app/autorun/scripts/ /root/app/autorun/agents/\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" -r /srv/app/autorun/autorun/scripts/* /root/app/autorun/scripts/\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#更新jar的运行时程序")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ln")]),s._v(" -s /srv/app/autorun/autorun/"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$JAR_CLD")]),s._v("  /root/app/autorun/agents/"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$JAR_CLD")]),s._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#记录初始化过")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("touch")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$FLAG_FILE")]),s._v("\n  \n  "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"脚本初始化完成..."')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# =============================================目录迁移及软引用配置======================================================")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#要更新的.jar ,先屏蔽了，暂时不用；")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /srv/app/autorun/update\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" -f ./"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$JAR_MGR")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" -f "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$JAR_MGR")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("/autorun/\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" -f ./"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$JAR_CLD")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" -f "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$JAR_CLD")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("/autorun/\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" -f ./"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$JAR_AGT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" -f "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$JAR_AGT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("/autorun/agents/agent_123/agent/\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# =============================================启动门户，巡检和agent======================================================")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"启动eureka..."')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /srv/app/portal/eureka "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v(" stop.sh "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v(" start.sh\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"启动GSMAppService..."')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /srv/app/portal/GSMAppService "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v(" stop.sh "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v(" start.sh\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"启动zookeeper..."')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /srv/app/autorun/zookeeper-3.4.8/bin "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" +x zkServer.sh "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" ./zkServer.sh start\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"启动autorun..."')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /srv/app/autorun/autorun/ "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v(" start.sh\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"启动agent..."')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /srv/app/autorun/autorun/agents/agent_123/agent "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("kill")]),s._v(" -9 "),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" pidfile.txt"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v(" agent_run.sh\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# echo "主机角色导入..."')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cd /srv/app/autorun/autorun && sh send.sh")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# sleep 5")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"初步启动完成..."')]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# netstat -antlp")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"启动nginx..."')]),s._v("\nnginx -g "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"daemon off;"')]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br"),n("span",{staticClass:"line-number"},[s._v("70")]),n("br"),n("span",{staticClass:"line-number"},[s._v("71")]),n("br"),n("span",{staticClass:"line-number"},[s._v("72")]),n("br"),n("span",{staticClass:"line-number"},[s._v("73")]),n("br"),n("span",{staticClass:"line-number"},[s._v("74")]),n("br"),n("span",{staticClass:"line-number"},[s._v("75")]),n("br"),n("span",{staticClass:"line-number"},[s._v("76")]),n("br"),n("span",{staticClass:"line-number"},[s._v("77")]),n("br"),n("span",{staticClass:"line-number"},[s._v("78")]),n("br"),n("span",{staticClass:"line-number"},[s._v("79")]),n("br"),n("span",{staticClass:"line-number"},[s._v("80")]),n("br"),n("span",{staticClass:"line-number"},[s._v("81")]),n("br"),n("span",{staticClass:"line-number"},[s._v("82")]),n("br"),n("span",{staticClass:"line-number"},[s._v("83")]),n("br"),n("span",{staticClass:"line-number"},[s._v("84")]),n("br"),n("span",{staticClass:"line-number"},[s._v("85")]),n("br"),n("span",{staticClass:"line-number"},[s._v("86")]),n("br"),n("span",{staticClass:"line-number"},[s._v("87")]),n("br"),n("span",{staticClass:"line-number"},[s._v("88")]),n("br"),n("span",{staticClass:"line-number"},[s._v("89")]),n("br"),n("span",{staticClass:"line-number"},[s._v("90")]),n("br"),n("span",{staticClass:"line-number"},[s._v("91")]),n("br"),n("span",{staticClass:"line-number"},[s._v("92")]),n("br"),n("span",{staticClass:"line-number"},[s._v("93")]),n("br"),n("span",{staticClass:"line-number"},[s._v("94")]),n("br"),n("span",{staticClass:"line-number"},[s._v("95")]),n("br"),n("span",{staticClass:"line-number"},[s._v("96")]),n("br"),n("span",{staticClass:"line-number"},[s._v("97")]),n("br"),n("span",{staticClass:"line-number"},[s._v("98")]),n("br"),n("span",{staticClass:"line-number"},[s._v("99")]),n("br"),n("span",{staticClass:"line-number"},[s._v("100")]),n("br"),n("span",{staticClass:"line-number"},[s._v("101")]),n("br"),n("span",{staticClass:"line-number"},[s._v("102")]),n("br"),n("span",{staticClass:"line-number"},[s._v("103")]),n("br"),n("span",{staticClass:"line-number"},[s._v("104")]),n("br"),n("span",{staticClass:"line-number"},[s._v("105")]),n("br"),n("span",{staticClass:"line-number"},[s._v("106")]),n("br"),n("span",{staticClass:"line-number"},[s._v("107")]),n("br"),n("span",{staticClass:"line-number"},[s._v("108")]),n("br"),n("span",{staticClass:"line-number"},[s._v("109")]),n("br"),n("span",{staticClass:"line-number"},[s._v("110")]),n("br"),n("span",{staticClass:"line-number"},[s._v("111")]),n("br"),n("span",{staticClass:"line-number"},[s._v("112")]),n("br"),n("span",{staticClass:"line-number"},[s._v("113")]),n("br"),n("span",{staticClass:"line-number"},[s._v("114")]),n("br"),n("span",{staticClass:"line-number"},[s._v("115")]),n("br"),n("span",{staticClass:"line-number"},[s._v("116")]),n("br"),n("span",{staticClass:"line-number"},[s._v("117")]),n("br"),n("span",{staticClass:"line-number"},[s._v("118")]),n("br"),n("span",{staticClass:"line-number"},[s._v("119")]),n("br"),n("span",{staticClass:"line-number"},[s._v("120")]),n("br"),n("span",{staticClass:"line-number"},[s._v("121")]),n("br"),n("span",{staticClass:"line-number"},[s._v("122")]),n("br"),n("span",{staticClass:"line-number"},[s._v("123")]),n("br"),n("span",{staticClass:"line-number"},[s._v("124")]),n("br"),n("span",{staticClass:"line-number"},[s._v("125")]),n("br"),n("span",{staticClass:"line-number"},[s._v("126")]),n("br"),n("span",{staticClass:"line-number"},[s._v("127")]),n("br"),n("span",{staticClass:"line-number"},[s._v("128")]),n("br"),n("span",{staticClass:"line-number"},[s._v("129")]),n("br"),n("span",{staticClass:"line-number"},[s._v("130")]),n("br"),n("span",{staticClass:"line-number"},[s._v("131")]),n("br"),n("span",{staticClass:"line-number"},[s._v("132")]),n("br"),n("span",{staticClass:"line-number"},[s._v("133")]),n("br")])]),n("h3",{attrs:{id:"pkg导出部署"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#pkg导出部署"}},[s._v("#")]),s._v(" pkg导出部署")]),s._v(" "),n("h4",{attrs:{id:"相关脚本"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#相关脚本"}},[s._v("#")]),s._v(" 相关脚本")]),s._v(" "),n("p",[n("code",[s._v("pkg.sh")])]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/bin/bash")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("###")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# @Author: samy")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# @email: yessz#foxmail.com")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# @time: 2022-02-12 13:21:47")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# @modAuthor: samy")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# @modTime: 2022-03-07 10:31:40")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# @desc: 发布现场部分")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Copyright © 2015~2022 BDP FE")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("### ")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("PRO_NAME")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("autorun-pro\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("PRO_VERSION")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.1")]),s._v(".0\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("HTTPD_PATH")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/var/www/html/files/autorun/pro/pkg\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DATETIME")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("date")]),s._v(" +%Y%m%d%H%M%S"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" ./images\ndocker save "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$PRO_NAME")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("gzip")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" ./images/"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$PRO_NAME")]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$PRO_VERSION")]),s._v(".tar.gz\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#docker export $PRO_NAME | gzip > ./images/$PRO_NAME:$PRO_VERSION.tar.gz")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" ./images "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$HTTPD_PATH")]),s._v("/\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" start.sh "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$HTTPD_PATH")]),s._v("/\n\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$HTTPD_PATH")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" tree -h\n\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"---压缩gz包用于发布---"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("/ "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" zcvf ./pkg-bak/"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$PRO_NAME")]),s._v("-"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$PRO_VERSION")]),s._v("-"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$DATETIME")]),s._v(".tar.gz ./pkg/\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" -lh\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br")])]),n("p",[n("code",[s._v("start.sh")])]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/bin/bash")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("###")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# @Author: samy")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# @email: yessz#foxmail.com")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# @time: 2022-02-12 13:21:47")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# @modAuthor: samy")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# @modTime: 2022-03-07 10:31:40")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# @desc: 发布现场部分")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Copyright © 2015~2022 BDP FE")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("### ")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("PRO_NAME")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("autorun-pro\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("PRO_VERSION")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.1")]),s._v(".0\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# import")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker save autorun-pro | gzip > ./images/autorun-pro:0.1.0.tar.gz")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker load < ./images/autorun-pro:0.1.0.tar.gz")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker import autorun-pro:1.0.0 ./images/autorun-pro:1.0.0.tar.gz")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker save $PRO_NAME | gzip > ./images/$PRO_NAME:$PRO_VERSION.tar.gz")]),s._v("\ndocker load "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" ./images/"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$PRO_NAME")]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$PRO_VERSION")]),s._v(".tar.gz\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#docker import ./images/$PRO_NAME:$PRO_VERSION.tar.gz")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# # stop")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker stop $PRO_NAME")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker rm $PRO_NAME")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#start")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"----准备好初始化host_role.csv-----"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p /data/autorun/autorun/role_template\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" ./host_role.csv /data/autorun/autorun/role_template/host_role.csv\n\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"---run...---"')]),s._v("\ndocker run -d "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --privileged "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 支持centos6 ssh centos7内部")]),s._v("\n  -p "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("38080")]),s._v(":80 -p "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("36379")]),s._v(":6379 -p "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("33306")]),s._v(":3306 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  -v /data/autorun/mysql/log:/var/log/mysql "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  -v /data/autorun/mysql/data:/var/lib/mysql "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  -v /data/autorun/autorun/role_template:/root/app/autorun/role_template "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --name "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$PRO_NAME")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$PRO_NAME")]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$PRO_VERSION")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker exec -it autorun-pro bash")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# curl localhost")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br")])]),n("h4",{attrs:{id:"配合jks做tag"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#配合jks做tag"}},[s._v("#")]),s._v(" 配合jks做Tag")]),s._v(" "),n("p",[n("img",{attrs:{src:t(443),alt:"image-20220310094528334"}})]),s._v(" "),n("h3",{attrs:{id:"镜像优化"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#镜像优化"}},[s._v("#")]),s._v(" 镜像优化")]),s._v(" "),n("h4",{attrs:{id:"优化后改成export-import"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#优化后改成export-import"}},[s._v("#")]),s._v(" 优化后改成export/import")]),s._v(" "),n("p",[s._v("镜像可以压缩到1G左右，符合方便钉钉传输；")]),s._v(" "),n("p",[n("strong",[s._v("最后发现是具有现有的容器才能打镜像，不合适现在场景；")])]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker export -o autorun-pro.tar autorun-pro")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker export autorun-pro > autorun-pro2.tar ")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker export autorun-pro | gzip > autorun-pro2.tar.gz ")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#pkg.sh")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker save $PRO_NAME | gzip > ./images/$PRO_NAME:$PRO_VERSION.tar.gz")]),s._v("\ndocker "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$PRO_NAME")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("gzip")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" ./images/"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$PRO_NAME")]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$PRO_VERSION")]),s._v(".tar.gz\ndocker "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" autorun-pro "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("gzip")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" ./images/autorun-pro:1.0.2.tar.gz\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#start.sh")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker load < ./images/$PRO_NAME:$PRO_VERSION.tar.gz")]),s._v("\ndocker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("import")]),s._v(" ./images/"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$PRO_NAME")]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$PRO_VERSION")]),s._v(".tar.gz\ndocker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("import")]),s._v(" ./images/autorun-pro:1.0.2.tar.gz\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#实践")]),s._v("\ndocker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" -a "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" autorun-pro "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 确保容器存在后，再导出镜像；")]),s._v("\ndocker "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" autorun-pro "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("gzip")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" ./images/autorun-pro:1.0.2.tar.gz\ndocker "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" autorun-pro "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("gzip")]),s._v(" -o ./images/autorun-pro:1.0.2.tar.gz\n\ndocker images "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" autorun-pro\ndocker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("import")]),s._v(" ./images/autorun-pro:1.0.2.tar.gz autorun-pro:1.0.2\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br")])]),n("h4",{attrs:{id:"experimental-参数设置为-true"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#experimental-参数设置为-true"}},[s._v("#")]),s._v(" experimental 参数设置为 true")]),s._v(" "),n("p",[s._v("没什么效果；待再次实验下；")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" docker restart\n\ndocker version\ndocker version -f "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{{.Server.Experimental}}'")]),s._v("\ndocker system info\n\ndocker build --no-cache --squash -t autorun-pro2 "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("h4",{attrs:{id:"run全部完全合并"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#run全部完全合并"}},[s._v("#")]),s._v(" RUN全部完全合并")]),s._v(" "),n("p",[s._v("压缩少了1G+; 3.93G压缩到2.71G")]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[s._v("RUN mkdir "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("p $WORKDIR/soft/nginx "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" cd $WORKDIR/soft/nginx \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" wget $URLBASE/soft/nginx/nginx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("1.18.0.tar.gz \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" wget $URLBASE/soft/nginx/nginx.conf \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" mkdir "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("p $WORKDIR/soft/redis "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" cd $WORKDIR/soft/redis \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" wget $URLBASE/soft/redis/redis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("3.2.11.tar.gz \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" wget $URLBASE/soft/redis/redis.conf \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" mkdir "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("p $WORKDIR/soft/mysql "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" cd $WORKDIR/soft/mysql \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" wget $URLBASE/soft/mysql/mysql"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("5.7.35.tar.gz \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" wget $URLBASE/soft/mysql/my.cnf \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" wget $URLBASE/soft/mysql/init.sql \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" wget $URLBASE/soft/mysql/setpwd.sql \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" mkdir "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("p $WORKDIR/soft/jdk "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" cd $WORKDIR/soft/jdk  \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" wget $URLBASE/soft/jdk/jdk"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("8u241"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("linux"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("x64.tar.gz \\\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# download pro info")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" mkdir "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("p $WORKDIR/portal "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" cd $WORKDIR/portal \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" wget $URLBASE/portal/AAWeb.tar.gz\\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" wget $URLBASE/portal/eureka.tar.gz\\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" wget $URLBASE/portal/GSMAppService.tar.gz\\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" wget $URLBASE/portal/dataportal.sql \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" mkdir "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("p $WORKDIR/autorun "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" cd $WORKDIR/autorun \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" wget $URLBASE/autorun/autorun.tar.gz \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" wget $URLBASE/autorun/zookeeper"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("3.4.8.tar.gz \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" wget $URLBASE/autorun/autorun.sql \\\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# install nginx")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" cd $WORKDIR/soft/nginx \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" tar "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("zxvf  nginx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("1.18.0.tar.gz \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" cd nginx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("1.18.0 "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" ./configure "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("prefix=/usr/local/nginx \\\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("pid"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("path=/var/run/nginx/nginx.pid \\\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("lock"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("path=/var/lock/nginx.lock \\\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("error"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("log"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("path=/var/log/nginx/error.log \\\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("http"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("log"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("path=/var/log/nginx/access.log \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" make "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" make install\\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" ln "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("s /usr/local/nginx/sbin/nginx /usr/sbin/nginx \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" rm "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("rf ../"),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("*.gz")]),s._v(" \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" cp "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("rf $WORKDIR/soft/nginx/nginx.conf /usr/local/nginx/conf/ \\\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# install redis")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" cd $WORKDIR/soft/redis \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" tar "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("zxvf  redis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("3.2.11.tar.gz \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" cd redis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("3.2.11 "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" make install PREFIX=/usr/local/redis \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" ln "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("s /usr/local/redis/bin/redis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("cli /usr/bin/redis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("cli \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" ln "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("s /usr/local/redis/bin/redis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("server /usr/bin/redis \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" rm "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("rf ../redis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("3.2* \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" cp "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("rf $WORKDIR/soft/redis/redis.conf /usr/local/redis/ \\\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# install mysql")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" useradd "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("s /sbin/nologin mysql \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" mkdir "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("p /var/lib/mysql/data \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" chown "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("R root /var/lib/mysql \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" chown "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("R mysql"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("mysql /var/lib/mysql \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" chown "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("R mysql /var/lib/mysql/data \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" cd $WORKDIR/soft/mysql \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" tar "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("zxvf mysql"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("5.7.35.tar.gz \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" cd mysql"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("5.7.35 \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" rpm "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("ivh mysql"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("community"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("common"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("5.7.35"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("1.el7.x86_64.rpm \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" rpm "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("ivh mysql"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("community"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("libs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("5.7.35"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("1.el7.x86_64.rpm \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" rpm "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("ivh mysql"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("community"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("client"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("5.7.35"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("1.el7.x86_64.rpm \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" rpm "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("ivh mysql"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("community"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("server"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("5.7.35"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("1.el7.x86_64.rpm \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" rm "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("rf ../mysql"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("5.7* \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" cp "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("rf $WORKDIR/soft/mysql/my.cnf /etc/my.cnf \\\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# install jdk")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" cd $WORKDIR/soft/jdk \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" tar "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("zxvf jdk"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("8u241"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("linux"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("x64.tar.gz \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" mv jdk1.8.0_241/ /usr/local/java/ \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" rm "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("rf "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("*.gz")]),s._v(" \\\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# pro")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" cd $WORKDIR/portal \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" tar "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("zxvf eureka.tar.gz\\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" tar "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("zxvf GSMAppService.tar.gz\\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" tar "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("zxvf AAWeb.tar.gz\\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" mv dist AAWeb \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" rm "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("rf "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("*.gz")]),s._v(" \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" cd $WORKDIR/autorun \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" tar "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("zxvf zookeeper"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("3.4.8.tar.gz \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" tar "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("zxvf autorun.tar.gz \\\n  "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" rm "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("rf "),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("*.gz")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br"),n("span",{staticClass:"line-number"},[s._v("70")]),n("br"),n("span",{staticClass:"line-number"},[s._v("71")]),n("br"),n("span",{staticClass:"line-number"},[s._v("72")]),n("br"),n("span",{staticClass:"line-number"},[s._v("73")]),n("br"),n("span",{staticClass:"line-number"},[s._v("74")]),n("br")])]),n("p",[n("img",{attrs:{src:t(444),alt:"image-20220328142605788"}})])])}),[],!1,null,null,null);a.default=r.exports}}]);